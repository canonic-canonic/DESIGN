
/* ═══════════════════════════════════════════════════════════════════
   LAYER 10 — TALK (Fleet-wide Chat Primitive)
   ═══════════════════════════════════════════════════════════════════

   TALK = CHAT + INTEL
   The universal conversation service. Every frontend gets it.
   Abstracted to AXIOMS in the GALAXY.

   HTML contract:
   <div class="talk-bar" id="talkBar">
       <div class="talk-dot"></div>
       <span class="talk-scope">SCOPE</span>
       <input class="talk-input" id="talkInput">
       <button class="talk-btn">TALK</button>
   </div>

   ═══════════════════════════════════════════════════════════════════ */

/* ── Talk dot + breathe (shared by overlay header) ── */
.talk-dot {
    width: 8px;
    height: 8px;
    background: var(--green);
    border-radius: 50%;
    animation: talk-breathe 3s ease-in-out infinite;
    flex-shrink: 0;
    box-shadow: 0 0 8px rgba(var(--runtime-rgb), 0.4);
}

@keyframes talk-breathe {
    0%, 100% { transform: scale(1); box-shadow: 0 0 8px rgba(var(--runtime-rgb), 0.4); }
    50% { transform: scale(1.3); box-shadow: 0 0 16px rgba(var(--runtime-rgb), 0.6), 0 0 32px rgba(var(--runtime-rgb), 0.2); }
}

.talk-scope {
    font-size: var(--font-2xs);
    font-weight: 700;
    letter-spacing: 0.12em;
    color: var(--dim);
    flex-shrink: 0;
    font-family: var(--mono);
    opacity: 0.7;
}

/* ── Talk Panel — a CONTROL, not a text box ── */
.talk-overlay {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 420px;
    max-width: 100vw;
    background: var(--panel);
    -webkit-backdrop-filter: var(--blur-overlay);
    backdrop-filter: var(--blur-overlay);
    z-index: var(--z-modal);
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    opacity: 0;
    pointer-events: none;
    transition: transform var(--transition-slow) var(--spring), opacity var(--transition-slow) var(--ease-out);
    border-left: 1px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
}

.talk-overlay.open {
    transform: translateX(0);
    opacity: 1;
    pointer-events: auto;
}

/* Scrim — dims page behind panel, click to close */
.talk-overlay::before {
    content: '';
    position: fixed;
    inset: 0;
    right: 420px;
    background: var(--scrim);
    opacity: 0;
    transition: opacity var(--transition-slow);
    pointer-events: none;
    z-index: -1;
}
.talk-overlay.open::before {
    opacity: 1;
    pointer-events: auto;
}

/* Header — commanding, tight */
.talk-overlay-header {
    display: flex;
    align-items: center;
    gap: var(--space-xs-sm);
    padding: var(--space-sm) var(--space-md);
    border-bottom: 1px solid var(--glass-border);
    flex-shrink: 0;
    background: var(--glass-subtle);
}

.talk-overlay-header .talk-dot {
    width: 9px;
    height: 9px;
}

.talk-overlay-header .talk-scope {
    font-size: var(--font-xs);
    font-weight: 700;
    letter-spacing: 0.14em;
    color: var(--fg);
    opacity: 0.75;
}

/* Provider select — moved from inline */
.talk-provider-select {
    background: var(--card);
    color: var(--fg);
    border: 1px solid var(--glass-strong);
    border-radius: var(--radius-xs);
    padding: 2px 6px;
    font-size: var(--font-xs);
    margin-left: auto;
    cursor: pointer;
    width: auto;
}

.talk-provider-label {
    font-size: var(--font-2xs);
    opacity: 0.5;
    margin-left: var(--space-2xs);
}

.talk-overlay-close {
    margin-left: 0;
    background: var(--glass-subtle);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    padding: var(--space-2xs) var(--space-xs-sm);
    color: var(--dim);
    cursor: pointer;
    font-size: var(--font-xs);
    font-family: var(--mono);
    font-weight: 600;
    letter-spacing: 0.05em;
    transition: all var(--transition-base) var(--spring);
}

.talk-overlay-close:hover {
    border-color: var(--glass-strong);
    color: var(--fg);
    background: var(--glass-border);
    transform: translateY(-1px);
}

/* ── Messages area ── */
.talk-messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-md) var(--space-md);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    scroll-behavior: smooth;
}

/* First message in TALK panel — the welcome — gets presence */
.talk-messages > .message:first-child {
    background: rgba(var(--accent-rgb, 59, 130, 246), 0.06);
    border: 1px solid rgba(var(--accent-rgb, 59, 130, 246), 0.12);
    border-radius: var(--radius-lg);
    padding: var(--space-sm-md) var(--space-md);
    font-size: var(--font-sm);
    line-height: 1.7;
    color: var(--fg);
    opacity: 0.9;
}

/* ── Talk Input — the draw ── */
.talk-input-row {
    display: flex;
    gap: var(--space-xs-sm);
    padding: var(--space-sm-md) var(--space-md);
    border-top: 1px solid var(--glass-border);
    flex-shrink: 0;
    background: var(--glass-subtle);
}

.talk-input-row input {
    flex: 1;
    background: var(--glass-border);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius);
    padding: var(--space-xs-sm) var(--space-sm);
    color: var(--fg);
    font-family: var(--font);
    font-size: var(--font-sm);
    outline: none;
    width: auto;
    transition: all var(--transition-slow) var(--ease-out);
}

.talk-input-row input:focus {
    border-color: rgba(var(--accent-rgb, 59, 130, 246), 0.4);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb, 59, 130, 246), 0.1), var(--shadow);
    background: var(--glass-hover);
}

.talk-input-row input::placeholder {
    color: var(--dim);
    opacity: 0.4;
}

.talk-input-row button {
    background: var(--accent);
    color: var(--fg);
    border: none;
    border-radius: var(--radius);
    padding: var(--space-xs-sm) var(--space-md);
    font-size: var(--font-sm);
    font-weight: 700;
    font-family: var(--font);
    cursor: pointer;
    transition: all var(--transition-base) var(--spring);
    letter-spacing: 0.05em;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(var(--accent-rgb, 59, 130, 246), 0.2);
}

.talk-input-row button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(var(--accent-rgb, 59, 130, 246), 0.3);
}
.talk-input-row button:active {
    transform: translateY(0) scale(0.97);
    box-shadow: 0 1px 4px rgba(var(--accent-rgb, 59, 130, 246), 0.15);
}

/* ── Talk — top position variant ── */
.talk-overlay[data-position="top"] {
    top: 0;
    left: 0;
    right: 0;
    bottom: auto;
    width: 100%;
    height: 50vh;
    max-width: 100vw;
    transform: translateY(-100%);
    border-left: none;
    border-bottom: 1px solid var(--glass-border);
}
.talk-overlay[data-position="top"].open {
    transform: translateY(0);
}
.talk-overlay[data-position="top"]::before {
    inset: 50vh 0 0 0;
    right: 0;
}

/* ── Talk — light theme ── */
[data-theme="light"] .talk-overlay {
    background: var(--panel);
    box-shadow: var(--shadow-lg);
}
[data-theme="light"] .talk-overlay::before {
    background: var(--scrim);
}
[data-theme="light"] .talk-input-row input {
    background: var(--glass-subtle);
}
[data-theme="light"] .talk-input-row input:focus {
    background: var(--bg);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb, 0,255,136), 0.1), var(--shadow);
}

@media (prefers-color-scheme: light) {
    :root:not([data-theme="dark"]) .talk-overlay {
        background: var(--panel);
        box-shadow: var(--shadow-lg);
    }
    :root:not([data-theme="dark"]) .talk-overlay::before {
        background: var(--scrim);
    }
    :root:not([data-theme="dark"]) .talk-input-row input {
        background: var(--glass-subtle);
    }
    :root:not([data-theme="dark"]) .talk-input-row input:focus {
        background: var(--bg);
    }
}

/* ── Talk — responsive ── */
@media (max-width: 640px) {
    /* Mobile: full-width panel */
    .talk-overlay { width: 100vw; border-left: none; }
    .talk-overlay::before { display: none; }
    .talk-messages { padding: var(--space-sm-md) var(--space-sm); }
    .talk-input-row { padding: var(--space-sm); }
}

@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    .talk-overlay { transform: none; }
    .talk-overlay.open { transform: none; }
}

