<!-- LAYOUT: post | Unified viewer | DESIGN.md 255 Map -->
<!-- All labels resolve from: page front matter → scope data → scope name -->
{% assign scope_key = page.scope | default: site.scope | downcase %}
{% assign sd = site.data[scope_key] %}
{% assign scope_up = page.scope | default: site.scope | upcase %}
{% assign back_label = page.back_label | default: sd.back_label | default: scope_up %}
{% assign back_href = page.back_href | default: sd.back_href %}
{% assign badge_label = page.badge | default: sd.badge_label | default: scope_up %}
<!DOCTYPE html>
<html lang="en" data-scope="{{ page.scope | default: site.scope | downcase }}">
<head>
  {% include HEAD.html title=page.title description=page.description %}
</head>
<body class="post-page">

  {% include NAV-UNIFIED.html mode="post" back_href=back_href back_label=back_label scope_label=scope %}

  <article class="post container">
    <header class="post-header">
      <div class="hero-badge">{{ page.badge | default: badge_label }}</div>
      <h1 class="gradient-text">{{ page.title }}</h1>
      {% if page.date %}<time class="post-date">{{ page.date | date: "%B %d, %Y" }}</time>{% endif %}
      {% if page.author %}<span class="post-author">{{ page.author }}</span>{% endif %}
    </header>

    {% if page.figure %}
    <figure class="post-figure">
      <div data-figure="{{ page.figure.type }}" data-config='{{ page.figure | jsonify }}'></div>
    </figure>
    {% endif %}

    <div class="post-body prose">
      {{ content }}
    </div>

    {% if page.proof %}
    {% include PROOF.html type="closing" quote=page.proof.quote sig=page.proof.sig cta=page.proof.cta %}
    {% endif %}
  </article>

  <footer id="footer">{% include FOOTER.html %}</footer>

  {% include SCRIPTS.html %}
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    document.querySelectorAll('code.language-mermaid').forEach(c=>{
      const d=document.createElement('div');
      d.classList.add('mermaid');
      d.textContent=c.textContent;
      c.parentElement.replaceWith(d);
    });
    mermaid.initialize({startOnLoad:true,theme:document.documentElement.classList.contains('dark')?'dark':'default'});
  </script>
</body>
</html>
