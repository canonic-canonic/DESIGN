{
  "version": 3,
  "sources": ["../../../src/worker.js", "../../../../../../../../opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-scheduled.ts", "../../../../../../../../opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-tMvm1r/middleware-insertion-facade.js", "../../../../../../../../opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/common.ts", "../bundle-tMvm1r/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/iDrDex/.canonic/design/TALK/.wrangler/tmp/dev-TIIqqI",
  "sourcesContent": ["/**\n * canonic-services \u2014 Cloudflare Worker\n *\n * TALK backend + AUTH. MAGIC governed. Direct mapping. Zero hardcoding.\n * CANON.json \u2192 talk.js \u2192 Worker \u2192 LLM\n *\n * Provider, model, tokens \u2014 all from wrangler.toml [vars].\n * GitHub OAuth \u2014 client_id from vars, client_secret from secrets.\n *\n * GET  /health              \u2014 fast status (provider, model, ts)\n * GET  /health?deep=true   \u2014 full gov tree scan (sitemap + surface checks + violations)\n * POST /chat         \u2014 conversation\n * GET  /auth/config  \u2014 GitHub OAuth config (client_id + scopes)\n * POST /auth/github  \u2014 exchange code for token, create server-side session\n * GET  /auth/session \u2014 validate session token, return user identity\n * POST /auth/logout  \u2014 delete session from KV\n * GET  /auth/grants?scope=X \u2014 check if session user can access scope X\n * POST /email/send   \u2014 send branded HTML email via Resend\n * POST /shop/checkout        \u2014 create Stripe Checkout session\n * POST /shop/webhook/stripe  \u2014 Stripe webhook verification endpoint\n * GET  /shop/wallet          \u2014 public-safe wallet summary from Stripe sessions\n * POST /talk/ledger          \u2014 log conversation turn to server-side ledger\n * GET  /talk/ledger?scope=X  \u2014 read session ledger for a scope\n * POST /talk/send            \u2014 cross-user message delivery\n * GET  /talk/inbox?scope=X   \u2014 read inbox for a user scope\n * POST /talk/ack             \u2014 acknowledge (mark read) inbox messages\n * POST /contribute            \u2014 submit governed contribution (COIN mint)\n * GET  /contribute?scope=X    \u2014 read contributions for a scope\n * GET  /omics/ncbi/*          \u2014 NCBI E-utilities proxy (GEO, ClinVar, PubMed)\n * GET  /omics/pharmgkb/*      \u2014 PharmGKB proxy (drug-gene interactions)\n *\n * MAGIC | CANONIC | 2026-02\n */\n\nconst CORS_DEFAULTS = {\n  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n};\n\nfunction corsOrigin(request, env) {\n  const raw = env && env.CORS_ALLOWED_ORIGINS ? String(env.CORS_ALLOWED_ORIGINS) : '*';\n  const allowed = raw.split(',').map(s => s.trim());\n  if (allowed.includes('*')) return '*';\n  const origin = request.headers.get('Origin') || '';\n  for (const a of allowed) {\n    if (a === origin) return origin;\n    if (a.startsWith('https://*.') && origin.startsWith('https://') && origin.endsWith(a.slice(9))) return origin;\n  }\n  return null;\n}\n\nfunction addCors(headers, origin) {\n  const h = new Headers(headers || {});\n  const o = origin !== undefined ? origin : _reqOrigin;\n  if (o) h.set('Access-Control-Allow-Origin', o);\n  for (const [k, v] of Object.entries(CORS_DEFAULTS)) h.set(k, v);\n  return h;\n}\n\n/**\n * fetchWithRetry \u2014 exponential backoff wrapper for external fetches.\n * Retries on network errors and 5xx responses. Respects timeoutMs per attempt.\n */\nasync function fetchWithRetry(url, opts = {}, { maxRetries = 3, baseMs = 500, timeoutMs = 10000 } = {}) {\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    const controller = new AbortController();\n    const timer = setTimeout(() => controller.abort(), timeoutMs);\n    try {\n      const res = await fetch(url, { ...opts, signal: controller.signal });\n      clearTimeout(timer);\n      if (res.ok || res.status < 500 || attempt === maxRetries) return res;\n      // 5xx \u2014 retry\n    } catch (e) {\n      clearTimeout(timer);\n      if (attempt === maxRetries) throw e;\n    }\n    // Exponential backoff with jitter\n    const delay = baseMs * Math.pow(2, attempt) * (0.5 + Math.random() * 0.5);\n    await new Promise(r => setTimeout(r, delay));\n  }\n}\n\nfunction coerceContentToText(content) {\n  // KiloCode and some OpenAI-compatible clients send rich content parts:\n  // - string\n  // - { text: \"...\" }\n  // - [{ type: \"text\", text: \"...\" }, ...]\n  if (typeof content === 'string') return content;\n  if (content && typeof content === 'object' && typeof content.text === 'string') return content.text;\n  if (Array.isArray(content)) {\n    const text = content\n      .map(p => {\n        if (!p) return '';\n        if (typeof p === 'string') return p;\n        if (typeof p.text === 'string') return p.text;\n        if (p.type === 'text' && typeof p.text === 'string') return p.text;\n        if (p.type === 'input_text' && typeof p.text === 'string') return p.text;\n        return '';\n      })\n      .filter(Boolean)\n      .join('');\n    return text || '';\n  }\n  return '';\n}\n\nconst PROVIDERS = {\n  anthropic: {\n    url: 'https://api.anthropic.com/v1/messages',\n    validate(env) {\n      if (!env.ANTHROPIC_API_KEY) return 'ANTHROPIC_API_KEY not configured';\n      return null;\n    },\n    build(env, system, messages) {\n      return {\n        headers: {\n          'Content-Type': 'application/json',\n          'x-api-key': env.ANTHROPIC_API_KEY,\n          'anthropic-version': env.ANTHROPIC_VERSION,\n        },\n        body: { model: env.MODEL, max_tokens: maxTokens(env), system, messages },\n      };\n    },\n    parse(data) { return data.content?.[0]?.text; },\n    async preflight(env) {\n      const started = Date.now();\n      const model = env.MODEL || 'claude-sonnet-4-20250514';\n      if (!env.ANTHROPIC_API_KEY) return { status: 'error', key_valid: false, model, error: 'ANTHROPIC_API_KEY not configured', elapsed_ms: 0 };\n      const timeout = intEnv(env, 'PREFLIGHT_TIMEOUT_MS', 5000);\n      try {\n        const res = await fetchWithTimeout('https://api.anthropic.com/v1/messages', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'x-api-key': env.ANTHROPIC_API_KEY,\n            'anthropic-version': env.ANTHROPIC_VERSION || '2023-06-01',\n          },\n          body: JSON.stringify({ model, max_tokens: 1, messages: [{ role: 'user', content: 'ping' }] }),\n        }, timeout);\n        const rl = parseAnthropicRateLimits(res.headers);\n        if (!res.ok) {\n          const text = await res.text();\n          const isAuth = res.status === 401 || res.status === 403;\n          let detail = `HTTP ${res.status}`;\n          try { const j = JSON.parse(text); if (j.error && j.error.message) detail = j.error.message; } catch (_) {}\n          const isCredit = res.status === 400 && detail.toLowerCase().includes('credit');\n          return { status: (isAuth || isCredit) ? 'error' : 'degraded', key_valid: !isAuth, model, ...rl, error: clampString(redactSecrets(detail), 200), elapsed_ms: Date.now() - started };\n        }\n        const deg = preflightDegraded(rl);\n        return { status: deg ? 'degraded' : 'ok', key_valid: true, model, ...rl, error: deg || undefined, elapsed_ms: Date.now() - started };\n      } catch (e) {\n        return { status: 'error', key_valid: false, model, error: clampString(String(e.message || e), 200), elapsed_ms: Date.now() - started };\n      }\n    },\n  },\n  openai: {\n    url(env) {\n      const raw = (env.OPENAI_BASE_URL || 'https://api.openai.com/v1').trim();\n      if (!raw) return '';\n      const base = raw.replace(/\\/+$/, '');\n      if (base.endsWith('/chat/completions')) return base;\n      if (base.endsWith('/v1')) return base + '/chat/completions';\n      return base + '/v1/chat/completions';\n    },\n    validate(env) {\n      if (!env.OPENAI_API_KEY) return 'OPENAI_API_KEY not configured';\n      if ((env.LANE_PROVIDER || '') === 'openai' && !(env.OPENAI_MODEL || '').trim()) return 'OPENAI_MODEL not configured';\n      return null;\n    },\n    build(env, system, messages) {\n      return {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${env.OPENAI_API_KEY}`,\n        },\n        body: { model: env.OPENAI_MODEL || env.MODEL, max_tokens: maxTokens(env), messages: [{ role: 'system', content: system }, ...messages] },\n      };\n    },\n    parse(data) { return data.choices?.[0]?.message?.content; },\n    async preflight(env) {\n      const started = Date.now();\n      const model = env.OPENAI_MODEL || env.MODEL || 'gpt-4o-mini';\n      if (!env.OPENAI_API_KEY) return { status: 'error', key_valid: false, model, error: 'OPENAI_API_KEY not configured', elapsed_ms: 0 };\n      const timeout = intEnv(env, 'PREFLIGHT_TIMEOUT_MS', 5000);\n      try {\n        const url = typeof PROVIDERS.openai.url === 'function' ? PROVIDERS.openai.url(env) : PROVIDERS.openai.url;\n        const res = await fetchWithTimeout(url, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${env.OPENAI_API_KEY}` },\n          body: JSON.stringify({ model, max_tokens: 1, messages: [{ role: 'user', content: 'ping' }] }),\n        }, timeout);\n        const rl = parseOpenAIRateLimits(res.headers);\n        if (!res.ok) {\n          const text = await res.text();\n          const isAuth = res.status === 401 || res.status === 403;\n          let detail = `HTTP ${res.status}`;\n          try { const j = JSON.parse(text); if (j.error && j.error.message) detail = j.error.message; } catch (_) {}\n          return { status: isAuth ? 'error' : 'degraded', key_valid: !isAuth, model, ...rl, error: clampString(redactSecrets(detail), 200), elapsed_ms: Date.now() - started };\n        }\n        const deg = preflightDegraded(rl);\n        return { status: deg ? 'degraded' : 'ok', key_valid: true, model, ...rl, error: deg || undefined, elapsed_ms: Date.now() - started };\n      } catch (e) {\n        return { status: 'error', key_valid: false, model, error: clampString(String(e.message || e), 200), elapsed_ms: Date.now() - started };\n      }\n    },\n  },\n  deepseek: {\n    url(env) {\n      const raw = (env.DEEPSEEK_BASE_URL || 'https://api.deepseek.com/v1').trim();\n      if (!raw) return '';\n      const base = raw.replace(/\\/+$/, '');\n      if (base.endsWith('/chat/completions')) return base;\n      if (base.endsWith('/v1')) return base + '/chat/completions';\n      return base + '/v1/chat/completions';\n    },\n    validate(env) {\n      if (!env.DEEPSEEK_API_KEY) return 'DEEPSEEK_API_KEY not configured';\n      if ((env.LANE_PROVIDER || '') === 'deepseek' && !(env.DEEPSEEK_MODEL || '').trim()) return 'DEEPSEEK_MODEL not configured';\n      return null;\n    },\n    build(env, system, messages) {\n      return {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${env.DEEPSEEK_API_KEY}`,\n        },\n        body: { model: env.DEEPSEEK_MODEL || env.MODEL, max_tokens: maxTokens(env), messages: [{ role: 'system', content: system }, ...messages] },\n      };\n    },\n    parse(data) { return data.choices?.[0]?.message?.content; },\n    async preflight(env) {\n      const started = Date.now();\n      const model = env.DEEPSEEK_MODEL || env.MODEL || 'deepseek-chat';\n      if (!env.DEEPSEEK_API_KEY) return { status: 'error', key_valid: false, model, error: 'DEEPSEEK_API_KEY not configured', elapsed_ms: 0 };\n      const timeout = intEnv(env, 'PREFLIGHT_TIMEOUT_MS', 5000);\n      try {\n        const url = typeof PROVIDERS.deepseek.url === 'function' ? PROVIDERS.deepseek.url(env) : PROVIDERS.deepseek.url;\n        const res = await fetchWithTimeout(url, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${env.DEEPSEEK_API_KEY}` },\n          body: JSON.stringify({ model, max_tokens: 1, messages: [{ role: 'user', content: 'ping' }] }),\n        }, timeout);\n        const rl = parseOpenAIRateLimits(res.headers);\n        if (!res.ok) {\n          const text = await res.text();\n          const isAuth = res.status === 401 || res.status === 403;\n          let detail = `HTTP ${res.status}`;\n          try { const j = JSON.parse(text); if (j.error && j.error.message) detail = j.error.message; } catch (_) {}\n          return { status: isAuth ? 'error' : 'degraded', key_valid: !isAuth, model, ...rl, error: clampString(redactSecrets(detail), 200), elapsed_ms: Date.now() - started };\n        }\n        const deg = preflightDegraded(rl);\n        return { status: deg ? 'degraded' : 'ok', key_valid: true, model, ...rl, error: deg || undefined, elapsed_ms: Date.now() - started };\n      } catch (e) {\n        return { status: 'error', key_valid: false, model, error: clampString(String(e.message || e), 200), elapsed_ms: Date.now() - started };\n      }\n    },\n  },\n  runpod: {\n    url(env) {\n      const raw = (env.RUNPOD_BASE_URL || '').trim();\n      if (!raw) return '';\n      const base = raw.replace(/\\/+$/, '');\n      if (base.endsWith('/chat/completions')) return base;\n      return base + '/chat/completions';\n    },\n    validate(env) {\n      if (!env.RUNPOD_API_KEY) return 'RUNPOD_API_KEY not configured';\n      if (!env.RUNPOD_BASE_URL) return 'RUNPOD_BASE_URL not configured';\n      return null;\n    },\n    build(env, system, messages) {\n      return {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + env.RUNPOD_API_KEY,\n        },\n        body: {\n          model: env.RUNPOD_MODEL || env.MODEL,\n          max_tokens: maxTokensFor('RUNPOD', env),\n          messages: [{ role: 'system', content: system }, ...messages],\n        },\n      };\n    },\n    parse(data) { return data.choices?.[0]?.message?.content; },\n    async preflight(env) {\n      const started = Date.now();\n      const model = env.RUNPOD_MODEL || env.MODEL;\n      if (!env.RUNPOD_API_KEY) return { status: 'error', key_valid: false, model, error: 'RUNPOD_API_KEY not configured', elapsed_ms: 0 };\n      const baseUrl = (env.RUNPOD_BASE_URL || '').trim();\n      if (!baseUrl) return { status: 'error', key_valid: true, model, error: 'RUNPOD_BASE_URL not configured', elapsed_ms: 0 };\n      const endpointId = runpodEndpointIdFromBaseUrl(baseUrl);\n      if (endpointId) {\n        const h = await runpodHealth(endpointId, env);\n        const w = h && h.workers ? h.workers : null;\n        if (!w) return { status: 'error', key_valid: true, model, error: 'health endpoint unreachable', elapsed_ms: Date.now() - started };\n        return {\n          status: (w.ready || 0) >= 1 && (w.throttled || 0) === 0 ? 'ok' : 'degraded',\n          key_valid: true, model,\n          workers_ready: w.ready || 0, workers_throttled: w.throttled || 0,\n          elapsed_ms: Date.now() - started,\n        };\n      }\n      if (isRunpodProxyBaseUrl(baseUrl)) {\n        const pr = await runpodProxyReady(baseUrl, env);\n        return {\n          status: pr && pr.ok ? 'ok' : 'degraded',\n          key_valid: true, model, proxy_ready: pr ? pr.ok : false,\n          elapsed_ms: Date.now() - started,\n        };\n      }\n      return { status: 'degraded', key_valid: true, model, error: 'unknown endpoint format', elapsed_ms: Date.now() - started };\n    },\n  },\n  vastai: {\n    // Vast.ai instances typically run an OpenAI-compatible server (vLLM) at\n    //   http(s)://<ip>:<port>/v1\n    // This adapter expects VASTAI_BASE_URL to point at that base, then appends\n    // /chat/completions (same pattern as RUNPOD).\n    url(env) {\n      const raw = (env.VASTAI_BASE_URL || '').trim();\n      if (!raw) return '';\n      const base = raw.replace(/\\/+$/, '');\n      if (base.endsWith('/chat/completions')) return base;\n      return base + '/chat/completions';\n    },\n    validate(env) {\n      if (!env.VASTAI_BASE_URL) return 'VASTAI_BASE_URL not configured';\n      // VASTAI_API_KEY is optional; only required if your upstream enforces it.\n      return null;\n    },\n    build(env, system, messages) {\n      const key = (env.VASTAI_API_KEY || env.VLLM_API_KEY || '').trim();\n      const headers = { 'Content-Type': 'application/json' };\n      if (key) headers.Authorization = 'Bearer ' + key;\n      return {\n        headers,\n        body: {\n          model: env.VASTAI_MODEL || env.MODEL,\n          max_tokens: maxTokensFor('VASTAI', env),\n          messages: [{ role: 'system', content: system }, ...messages],\n        },\n      };\n    },\n    parse(data) { return data.choices?.[0]?.message?.content; },\n    async preflight(env) {\n      const started = Date.now();\n      const model = env.VASTAI_MODEL || env.MODEL;\n      const baseUrl = (env.VASTAI_BASE_URL || '').trim();\n      if (!baseUrl) return { status: 'error', key_valid: false, model, error: 'VASTAI_BASE_URL not configured', elapsed_ms: 0 };\n      const timeout = intEnv(env, 'PREFLIGHT_TIMEOUT_MS', 5000);\n      const b = baseUrl.replace(/\\/+$/, '');\n      try {\n        const headers = { 'Accept': 'application/json' };\n        const key = (env.VASTAI_API_KEY || env.VLLM_API_KEY || '').trim();\n        if (key) headers.Authorization = 'Bearer ' + key;\n        const r = await fetchWithTimeout(b + '/models', { headers }, timeout);\n        return {\n          status: r.ok ? 'ok' : 'degraded',\n          key_valid: true, model, proxy_ready: r.ok,\n          elapsed_ms: Date.now() - started,\n        };\n      } catch (e) {\n        return { status: 'error', key_valid: false, model, error: clampString(String(e.message || e), 200), elapsed_ms: Date.now() - started };\n      }\n    },\n  },\n};\n\nfunction clampInt(n, lo, hi) {\n  if (!Number.isFinite(n)) return lo;\n  return Math.max(lo, Math.min(hi, n));\n}\n\nfunction clampString(s, maxLen) {\n  if (typeof s !== 'string') return '';\n  if (s.length <= maxLen) return s;\n  return s.slice(0, maxLen) + '\u2026';\n}\n\nfunction parseIntEnv(env, key) {\n  const v = env[key];\n  if (v === undefined || v === null || v === '') return null;\n  const n = parseInt(v, 10);\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction maxTokens(env) {\n  // Governance: clamp requested max_tokens to an explicit min/max envelope.\n  const lo = parseIntEnv(env, 'TOKENS_MIN') ?? 16;\n  const hi = parseIntEnv(env, 'TOKENS_MAX') ?? 4096;\n  const req = parseIntEnv(env, 'MAX_TOKENS') ?? hi;\n  return clampInt(req, lo, hi);\n}\n\nfunction maxTokensFor(providerName, env) {\n  // Provider-specific clamps override global min/max when set.\n  const prefix = String(providerName || '').toUpperCase();\n  const lo = parseIntEnv(env, `${prefix}_TOKENS_MIN`) ?? parseIntEnv(env, 'TOKENS_MIN') ?? 16;\n  const hi = parseIntEnv(env, `${prefix}_TOKENS_MAX`) ?? parseIntEnv(env, 'TOKENS_MAX') ?? 4096;\n  const req = parseIntEnv(env, 'MAX_TOKENS') ?? hi;\n  return clampInt(req, lo, hi);\n}\n\nfunction timeoutMsFor(providerName, env) {\n  // Defaults: Runpod cold starts can hang behind Cloudflare 504s; keep a short\n  // timeout and fallback rather than taking down /chat.\n  if (providerName === 'runpod') return parseIntEnv(env, 'RUNPOD_TIMEOUT_MS') ?? 12000;\n  if (providerName === 'vastai') return parseIntEnv(env, 'VASTAI_TIMEOUT_MS') ?? (parseIntEnv(env, 'PROVIDER_TIMEOUT_MS') ?? 25000);\n  return parseIntEnv(env, 'PROVIDER_TIMEOUT_MS') ?? 25000;\n}\n\nfunction redactSecrets(s) {\n  if (typeof s !== 'string' || !s) return '';\n  return s\n    .replace(/Bearer\\\\s+[A-Za-z0-9._\\\\-]+/g, 'Bearer [REDACTED]')\n    .replace(/sk-[A-Za-z0-9_\\\\-]+/g, 'sk-[REDACTED]')\n    .replace(/re_[A-Za-z0-9_\\\\-]+/g, 're_[REDACTED]');\n}\n\nasync function fetchWithTimeout(url, init, ms) {\n  // AbortSignal.timeout exists in Workers; keep a fallback for safety.\n  if (typeof AbortSignal !== 'undefined' && typeof AbortSignal.timeout === 'function') {\n    return fetch(url, { ...init, signal: AbortSignal.timeout(ms) });\n  }\n  const controller = new AbortController();\n  const t = setTimeout(() => controller.abort(), ms);\n  try {\n    return await fetch(url, { ...init, signal: controller.signal });\n  } finally {\n    clearTimeout(t);\n  }\n}\n\nfunction boolEnv(env, key, fallback = false) {\n  const raw = String(env && env[key] !== undefined ? env[key] : '').trim().toLowerCase();\n  if (!raw) return !!fallback;\n  return raw === '1' || raw === 'true' || raw === 'yes' || raw === 'on';\n}\n\nfunction intEnv(env, key, fallback) {\n  const n = parseIntEnv(env, key);\n  return Number.isFinite(n) ? n : fallback;\n}\n\n// \u2500\u2500 Preflight rate-limit header parsers (GOV: TALK/TALK.md \u00A7 Preflight) \u2500\u2500\n\nfunction parseAnthropicRateLimits(headers) {\n  const rl = {};\n  const rr = headers.get('anthropic-ratelimit-requests-remaining');\n  const rlim = headers.get('anthropic-ratelimit-requests-limit');\n  const tr = headers.get('anthropic-ratelimit-tokens-remaining');\n  const tlim = headers.get('anthropic-ratelimit-tokens-limit');\n  if (rr !== null) rl.requests_remaining = parseInt(rr, 10);\n  if (rlim !== null) rl.requests_limit = parseInt(rlim, 10);\n  if (tr !== null) rl.tokens_remaining = parseInt(tr, 10);\n  if (tlim !== null) rl.tokens_limit = parseInt(tlim, 10);\n  const rReset = headers.get('anthropic-ratelimit-requests-reset');\n  const tReset = headers.get('anthropic-ratelimit-tokens-reset');\n  if (rReset) rl.requests_reset = rReset;\n  if (tReset) rl.tokens_reset = tReset;\n  return rl;\n}\n\nfunction parseOpenAIRateLimits(headers) {\n  const rl = {};\n  const rr = headers.get('x-ratelimit-remaining-requests');\n  const rlim = headers.get('x-ratelimit-limit-requests');\n  const tr = headers.get('x-ratelimit-remaining-tokens');\n  const tlim = headers.get('x-ratelimit-limit-tokens');\n  if (rr !== null) rl.requests_remaining = parseInt(rr, 10);\n  if (rlim !== null) rl.requests_limit = parseInt(rlim, 10);\n  if (tr !== null) rl.tokens_remaining = parseInt(tr, 10);\n  if (tlim !== null) rl.tokens_limit = parseInt(tlim, 10);\n  const rReset = headers.get('x-ratelimit-reset-requests');\n  const tReset = headers.get('x-ratelimit-reset-tokens');\n  if (rReset) rl.requests_reset = rReset;\n  if (tReset) rl.tokens_reset = tReset;\n  return rl;\n}\n\nfunction preflightDegraded(rl) {\n  if (rl.requests_remaining !== undefined && rl.requests_limit > 0) {\n    if (rl.requests_remaining / rl.requests_limit < 0.05) return 'requests_low';\n  }\n  if (rl.tokens_remaining !== undefined && rl.tokens_limit > 0) {\n    if (rl.tokens_remaining / rl.tokens_limit < 0.05) return 'tokens_low';\n  }\n  return null;\n}\n\nfunction isoFromUnix(tsSec) {\n  if (!Number.isFinite(tsSec)) return new Date().toISOString();\n  return new Date(tsSec * 1000).toISOString();\n}\n\nfunction normalizeShopEvent(v) {\n  const s = String(v || '').trim().toUpperCase();\n  return (s === 'SALE' || s === 'DONATION' || s === 'INVEST' || s === 'BILL' || s === 'CLOSE') ? s : '';\n}\n\nfunction normalizeShopProduct(v) {\n  const s = String(v || '').trim().toUpperCase();\n  if (!s) return 'GENERAL';\n  if (!/^[A-Z0-9][A-Z0-9-]{0,47}$/.test(s)) return 'GENERAL';\n  return s;\n}\n\nfunction stripeApiBase(env) {\n  return String(env.STRIPE_API_BASE || 'https://api.stripe.com').replace(/\\/+$/, '');\n}\n\nasync function stripeApiRequest(env, method, path, formFields) {\n  if (!env.STRIPE_SECRET_KEY) {\n    return { ok: false, status: 500, error: 'STRIPE_SECRET_KEY not configured' };\n  }\n  const headers = {\n    'Authorization': `Bearer ${env.STRIPE_SECRET_KEY}`,\n  };\n  let body = null;\n  if (formFields && typeof formFields === 'object') {\n    headers['Content-Type'] = 'application/x-www-form-urlencoded';\n    const params = new URLSearchParams();\n    for (const [k, v] of Object.entries(formFields)) {\n      if (v === undefined || v === null || v === '') continue;\n      params.set(k, String(v));\n    }\n    body = params.toString();\n  }\n  try {\n    const res = await fetchWithRetry(stripeApiBase(env) + path, { method, headers, body }, { maxRetries: 2, timeoutMs: 15000 });\n    const raw = await res.text();\n    let data;\n    try { data = JSON.parse(raw); } catch { data = { raw }; }\n    if (!res.ok) {\n      const msg = (data && data.error && data.error.message) ? data.error.message : `Stripe ${res.status}`;\n      return { ok: false, status: res.status, error: msg, data };\n    }\n    return { ok: true, status: res.status, data };\n  } catch (e) {\n    return { ok: false, status: 502, error: `Stripe fetch error: ${String(e && e.message ? e.message : e)}` };\n  }\n}\n\nfunction stripeSignatureParts(headerValue) {\n  const out = { t: '', v1: [] };\n  const h = String(headerValue || '').trim();\n  if (!h) return out;\n  for (const part of h.split(',')) {\n    const idx = part.indexOf('=');\n    if (idx === -1) continue;\n    const key = part.slice(0, idx).trim();\n    const val = part.slice(idx + 1).trim();\n    if (key === 't') out.t = val;\n    if (key === 'v1' && val) out.v1.push(val);\n  }\n  return out;\n}\n\nfunction timingSafeEqHex(a, b) {\n  const x = String(a || '');\n  const y = String(b || '');\n  if (x.length !== y.length) return false;\n  let diff = 0;\n  for (let i = 0; i < x.length; i++) diff |= x.charCodeAt(i) ^ y.charCodeAt(i);\n  return diff === 0;\n}\n\nasync function stripeVerifyWebhookSignature(rawBody, sigHeader, secret, toleranceSec) {\n  if (!secret) return { ok: false, error: 'STRIPE_WEBHOOK_SECRET not configured' };\n  const parts = stripeSignatureParts(sigHeader);\n  if (!parts.t || !parts.v1.length) return { ok: false, error: 'Missing Stripe signature fields' };\n\n  const ts = parseInt(parts.t, 10);\n  if (!Number.isFinite(ts)) return { ok: false, error: 'Invalid Stripe signature timestamp' };\n  const nowSec = Math.floor(Date.now() / 1000);\n  if (Math.abs(nowSec - ts) > toleranceSec) return { ok: false, error: 'Stripe signature timestamp out of tolerance' };\n\n  const payload = `${parts.t}.${rawBody}`;\n  const enc = new TextEncoder();\n  const key = await crypto.subtle.importKey(\n    'raw',\n    enc.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign'],\n  );\n  const sigBuf = await crypto.subtle.sign('HMAC', key, enc.encode(payload));\n  const sigHex = Array.from(new Uint8Array(sigBuf)).map(b => b.toString(16).padStart(2, '0')).join('');\n\n  const matched = parts.v1.some(v => timingSafeEqHex(v.toLowerCase(), sigHex.toLowerCase()));\n  if (!matched) return { ok: false, error: 'Stripe signature mismatch' };\n  return { ok: true };\n}\n\nfunction initWalletSummary() {\n  return {\n    canon: 'WALLET.v1',\n    source: 'stripe',\n    currency: 'COIN',\n    work_equals_coin: true,\n    events: 0,\n    balance: 0,\n    last_close: '',\n    updated_at: new Date().toISOString(),\n    totals: {\n      SALE: 0,\n      DONATION: 0,\n      INVEST: 0,\n      BILL: 0,\n      CLOSE: 0,\n      credit: 0,\n      debit: 0,\n      net: 0,\n    },\n    services: {},\n    products: {},\n    recent: [],\n  };\n}\n\nfunction applyWalletDelta(bucket, key, delta) {\n  const k = String(key || 'GENERAL').toUpperCase();\n  if (!bucket[k]) bucket[k] = { credit: 0, debit: 0, net: 0 };\n  if (delta >= 0) bucket[k].credit += delta;\n  else bucket[k].debit += Math.abs(delta);\n  bucket[k].net = bucket[k].credit - bucket[k].debit;\n}\n\nfunction sortedWalletBucket(bucket, topN) {\n  const rows = Object.entries(bucket).map(([k, row]) => ({\n    k,\n    credit: row.credit || 0,\n    debit: row.debit || 0,\n    net: row.net || 0,\n  }));\n  rows.sort((a, b) => (b.net - a.net) || (b.credit - a.credit) || (a.debit - b.debit) || a.k.localeCompare(b.k));\n  return topN > 0 ? rows.slice(0, topN) : rows;\n}\n\nfunction walletEventFromStripeSession(session, coinToCents) {\n  if (!session || session.status !== 'complete' || session.payment_status !== 'paid') return null;\n  const md = session.metadata || {};\n  const eventType = normalizeShopEvent(md.event || md.type || 'SALE') || 'SALE';\n  const amountCoinRaw = parseInt(md.amount_coin || '', 10);\n  const amountCoin = Number.isFinite(amountCoinRaw) && amountCoinRaw > 0\n    ? amountCoinRaw\n    : Math.max(1, Math.round((Number(session.amount_total || 0) / Math.max(1, coinToCents))));\n  const product = normalizeShopProduct(md.product || 'GENERAL');\n  const service = normalizeShopProduct(md.service || 'BOOK');\n  const delta = (eventType === 'BILL') ? -amountCoin : (eventType === 'CLOSE' ? 0 : amountCoin);\n  return {\n    id: String(session.id || ''),\n    ts: isoFromUnix(Number(session.created || 0)),\n    type: eventType,\n    service,\n    product,\n    amount: amountCoin,\n    delta,\n  };\n}\n\n// Global per-request origin \u2014 set at top of fetch handler, read by json() and addCors()\nlet _reqOrigin = '*';\n\n/**\n * deepHealth \u2014 Full governance tree scan with KV-cached rotation.\n * GOV: MONITORING/CANON.md.\n *\n * Problem: Cloudflare Workers have a 50-subrequest limit, but routing Workers\n * on hadleylab.org/canonic.org consume ~2 subrequests per fetch (request +\n * redirect follow). With 42+ surfaces, a single pass exceeds the budget.\n *\n * Solution: KV-cached rotation. Each invocation checks up to HEALTH_BUDGET\n * surfaces (default 18, safe within the 50-subrequest limit). Results are\n * cached in TALK_KV with a TTL (default 300s). Stale/missing entries are\n * prioritised. After 2-3 calls all surfaces are verified.\n *\n * Private scopes (GOV_PRIVATE_SCOPES) are listed in the sitemap but not\n * probed \u2014 they have no public surface page by design.\n */\nasync function deepHealth(env) {\n  const vanity = (env.GOV_VANITY_DOMAINS || '').split(',').filter(Boolean);\n  const privateSet = new Set((env.GOV_PRIVATE_SCOPES || '').split(',').filter(Boolean));\n  const CACHE_TTL = parseInt(env.HEALTH_CACHE_TTL_S || '300', 10) * 1000;\n  const BUDGET = parseInt(env.HEALTH_BUDGET || '18', 10);\n  const CACHE_KEY = 'health:deep:cache';\n\n  // \u2500\u2500 Auto-discover all governed surfaces from compiled manifest \u2500\u2500\n  const fleetRoots = (env.GOV_FLEET_ROOTS || 'https://hadleylab.org,https://canonic.org').split(',').filter(Boolean);\n  const sitemap = [];\n  const allChecks = [];\n  const seen = new Set();\n\n  for (const base of fleetRoots) {\n    const fleet = new URL(base).hostname.split('.')[0];\n    let discovered = false;\n    try {\n      const resp = await fetch(`${base}/surfaces.json`, {\n        headers: { 'User-Agent': 'canonic-health/1.0' },\n      });\n      if (resp.ok) {\n        const surfaces = await resp.json();\n        for (const s of surfaces) {\n          const url = base + s.path;\n          if (seen.has(url)) continue;\n          seen.add(url);\n          const entry = { scope: s.scope, fleet, urls: [url] };\n          if (s.surface_type) entry.surface_type = s.surface_type;\n          if (privateSet.has(s.scope)) { entry.private = true; sitemap.push(entry); continue; }\n          sitemap.push(entry);\n          allChecks.push({ url, scope: s.scope });\n        }\n        discovered = true;\n      }\n    } catch (_) {}\n\n    // Fallback to env var lists if surfaces.json unavailable\n    if (!discovered) {\n      const envKey = fleet === 'hadleylab' ? 'GOV_HADLEYLAB_SCOPES' : 'GOV_CANONIC_SCOPES';\n      const scopes = (env[envKey] || '').split(',').filter(Boolean);\n      const prefix = fleet === 'hadleylab' ? `${base}/SERVICES/` : `${base}/`;\n      for (const scope of scopes) {\n        const url = `${prefix}${scope}/`;\n        if (seen.has(url)) continue;\n        seen.add(url);\n        const entry = { scope, fleet, urls: [url] };\n        if (privateSet.has(scope)) { entry.private = true; sitemap.push(entry); continue; }\n        sitemap.push(entry);\n        allChecks.push({ url, scope });\n      }\n      if (fleet === 'hadleylab') {\n        const extra = (env.GOV_EXTRA_SURFACES || '').split(',').filter(Boolean);\n        for (const rawUrl of extra) {\n          const u = rawUrl.endsWith('/') ? rawUrl : rawUrl + '/';\n          if (seen.has(u)) continue;\n          seen.add(u);\n          const scope = u.replace(/\\/$/, '').split('/').pop();\n          allChecks.push({ url: u, scope });\n          sitemap.push({ scope, fleet, urls: [u] });\n        }\n      }\n    }\n  }\n  // Vanity domains\n  for (const v of vanity) {\n    const u = v.endsWith('/') ? v : v + '/';\n    if (!seen.has(u)) { allChecks.push({ url: u, scope: '_vanity' }); seen.add(u); }\n  }\n\n  // \u2500\u2500 Load cached results from KV \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  let cached = {};\n  try {\n    const raw = env.TALK_KV ? await env.TALK_KV.get(CACHE_KEY) : null;\n    if (raw) cached = JSON.parse(raw);\n  } catch (_) { /* cache miss */ }\n  const now = Date.now();\n\n  // \u2500\u2500 Partition: stale (need re-check) vs fresh (serve from cache)\n  const stale = [];\n  const fresh = [];\n  for (const c of allChecks) {\n    const entry = cached[c.url];\n    if (entry && (now - entry.ts) < CACHE_TTL) {\n      fresh.push(entry);\n    } else {\n      stale.push(c);\n    }\n  }\n\n  // \u2500\u2500 Check up to BUDGET surfaces (prioritise stale) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const toCheck = stale.slice(0, BUDGET);\n  const BATCH = 3;\n  const freshResults = [];\n  let aborted = false;\n  for (let i = 0; i < toCheck.length; i += BATCH) {\n    if (aborted) break;\n    const batch = toCheck.slice(i, i + BATCH);\n    const results = await Promise.allSettled(\n      batch.map(async ({ url, scope }) => {\n        try {\n          const resp = await fetch(url, {\n            method: 'HEAD',\n            headers: { 'User-Agent': 'canonic-health/1.0' },\n            redirect: 'follow',\n          });\n          const code = resp.status;\n          return { url, scope, status: code < 400 ? 'ok' : 'error', detail: code < 400 ? null : `HTTP ${code}`, ts: now };\n        } catch (e) {\n          const msg = String(e.message || e);\n          if (msg.includes('Too many subrequests')) { aborted = true; }\n          return { url, scope, status: 'unreachable', detail: msg, ts: now };\n        }\n      })\n    );\n    for (const r of results) {\n      if (r.status === 'fulfilled') freshResults.push(r.value);\n    }\n  }\n\n  // \u2500\u2500 Merge fresh results into cache \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  for (const r of freshResults) cached[r.url] = r;\n  // Evict entries older than 2\u00D7 TTL\n  for (const key of Object.keys(cached)) {\n    if ((now - cached[key].ts) > CACHE_TTL * 2) delete cached[key];\n  }\n  // Write back to KV\n  try {\n    if (env.TALK_KV) {\n      await env.TALK_KV.put(CACHE_KEY, JSON.stringify(cached), { expirationTtl: Math.ceil(CACHE_TTL * 2 / 1000) });\n    }\n  } catch (_) { /* non-fatal */ }\n\n  // \u2500\u2500 Assemble response \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Combine: freshResults + cached fresh entries + private scopes + any remaining unchecked\n  const surfaces = [];\n  const checkedUrls = new Set(freshResults.map(r => r.url));\n  // Fresh results first\n  for (const r of freshResults) {\n    surfaces.push({ url: r.url, scope: r.scope, status: r.status, detail: r.detail || undefined });\n  }\n  // Cached results (not re-checked this call)\n  for (const f of fresh) {\n    if (!checkedUrls.has(f.url)) {\n      const age = Math.round((now - f.ts) / 1000);\n      surfaces.push({ url: f.url, scope: f.scope, status: f.status, detail: f.detail || undefined, cached: `${age}s ago` });\n    }\n  }\n  // Private scopes \u2014 listed but not probed (discovered from sitemap)\n  for (const sm of sitemap) {\n    if (!sm.private) continue;\n    surfaces.push({ url: sm.urls[0], scope: sm.scope, status: 'private', detail: 'no public surface (by design)' });\n  }\n  // Remaining unchecked (stale, exceeded budget this call, no cache)\n  const allCovered = new Set(surfaces.map(s => s.url));\n  for (const c of allChecks) {\n    if (!allCovered.has(c.url)) {\n      surfaces.push({ url: c.url, scope: c.scope, status: 'pending', detail: 'queued for next rotation' });\n    }\n  }\n\n  // \u2500\u2500 Internal service checks (zero subrequests) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const services = [];\n  const svcViolations = [];\n\n  // TALK: verify primary provider is configured\n  const primary = env.PROVIDER;\n  const primaryProvider = PROVIDERS[primary];\n  if (!primaryProvider) {\n    services.push({ service: 'TALK', status: 'error', detail: `Unknown provider: ${primary}` });\n    svcViolations.push({ type: 'SERVICE_ERROR', service: 'TALK', detail: `Unknown provider: ${primary}` });\n  } else {\n    const valErr = primaryProvider.validate ? primaryProvider.validate(env) : null;\n    if (valErr) {\n      services.push({ service: 'TALK', status: 'error', detail: valErr });\n      svcViolations.push({ type: 'SERVICE_ERROR', service: 'TALK', detail: valErr });\n    } else {\n      services.push({ service: 'TALK', status: 'ok', provider: primary, model: env.MODEL });\n    }\n  }\n\n  // TALK fallback chain\n  const chain = env.PROVIDER_CHAIN ? String(env.PROVIDER_CHAIN).split(',').map(s => s.trim()).filter(Boolean) : [primary];\n  const chainStatus = chain.map(name => {\n    const p = PROVIDERS[name];\n    if (!p) return { provider: name, status: 'error', detail: 'unknown provider' };\n    const err = p.validate ? p.validate(env) : null;\n    return err ? { provider: name, status: 'error', detail: err } : { provider: name, status: 'ok' };\n  });\n  services.push({ service: 'TALK_CHAIN', status: chainStatus.every(c => c.status === 'ok') ? 'ok' : chainStatus.some(c => c.status === 'ok') ? 'degraded' : 'error', chain: chainStatus });\n  for (const c of chainStatus) {\n    if (c.status === 'error') svcViolations.push({ type: 'SERVICE_ERROR', service: `TALK_CHAIN/${c.provider}`, detail: c.detail });\n  }\n\n  // TALK_PREFLIGHT: live API probe for configured providers (GOV: TALK/TALK.md \u00A7 Preflight)\n  if (boolEnv(env, 'PREFLIGHT_HEALTH', false)) {\n    const PREFLIGHT_CACHE_KEY = 'health:preflight:cache';\n    const PREFLIGHT_TTL = parseInt(env.PREFLIGHT_CACHE_TTL_S || '120', 10) * 1000;\n    let preflightResult = null;\n\n    try {\n      const raw = env.TALK_KV ? await env.TALK_KV.get(PREFLIGHT_CACHE_KEY) : null;\n      if (raw) {\n        const cached = JSON.parse(raw);\n        if (cached && cached.ts && (now - cached.ts) < PREFLIGHT_TTL) {\n          preflightResult = cached;\n          preflightResult._cached = true;\n          preflightResult._cached_age_s = Math.round((now - cached.ts) / 1000);\n        }\n      }\n    } catch (_) {}\n\n    if (!preflightResult) {\n      try {\n        preflightResult = await preflightAllProviders(env);\n        preflightResult.ts = now;\n        if (env.TALK_KV) {\n          try {\n            await env.TALK_KV.put(PREFLIGHT_CACHE_KEY, JSON.stringify(preflightResult), {\n              expirationTtl: Math.ceil(PREFLIGHT_TTL * 2 / 1000),\n            });\n          } catch (_) {}\n        }\n      } catch (e) {\n        preflightResult = { service: 'TALK_PREFLIGHT', status: 'error', error: String(e.message || e) };\n      }\n    }\n\n    services.push(preflightResult);\n    if (preflightResult.providers) {\n      for (const [pName, pResult] of Object.entries(preflightResult.providers)) {\n        if (pResult.status === 'error') {\n          svcViolations.push({\n            type: 'PREFLIGHT_ERROR',\n            service: `TALK_PREFLIGHT/${pName}`,\n            detail: pResult.error || `${pName} preflight failed`,\n          });\n        }\n      }\n    }\n  }\n\n  // KV: verify TALK_KV is accessible\n  try {\n    if (env.TALK_KV) {\n      const testKey = 'health:kv:probe';\n      await env.TALK_KV.put(testKey, '1', { expirationTtl: 60 });\n      const v = await env.TALK_KV.get(testKey);\n      services.push({ service: 'KV', status: v === '1' ? 'ok' : 'error', detail: v === '1' ? null : 'read-back mismatch' });\n    } else {\n      services.push({ service: 'KV', status: 'error', detail: 'TALK_KV binding missing' });\n      svcViolations.push({ type: 'SERVICE_ERROR', service: 'KV', detail: 'TALK_KV binding missing' });\n    }\n  } catch (e) {\n    services.push({ service: 'KV', status: 'error', detail: String(e.message || e) });\n    svcViolations.push({ type: 'SERVICE_ERROR', service: 'KV', detail: String(e.message || e) });\n  }\n\n  // AUTH: verify GitHub OAuth config\n  if (env.GITHUB_CLIENT_ID) {\n    services.push({ service: 'AUTH', status: 'ok' });\n  } else {\n    services.push({ service: 'AUTH', status: 'error', detail: 'GITHUB_CLIENT_ID missing' });\n    svcViolations.push({ type: 'SERVICE_ERROR', service: 'AUTH', detail: 'GITHUB_CLIENT_ID missing' });\n  }\n\n  // EMAIL: verify Resend config\n  if (env.RESEND_API_KEY) {\n    services.push({ service: 'EMAIL', status: 'ok' });\n  } else {\n    services.push({ service: 'EMAIL', status: 'error', detail: 'RESEND_API_KEY missing' });\n    svcViolations.push({ type: 'SERVICE_ERROR', service: 'EMAIL', detail: 'RESEND_API_KEY missing' });\n  }\n\n  // SHOP: verify Stripe config\n  if (env.STRIPE_SECRET_KEY && env.STRIPE_WEBHOOK_SECRET) {\n    services.push({ service: 'SHOP', status: 'ok' });\n  } else {\n    const missing = [!env.STRIPE_SECRET_KEY && 'STRIPE_SECRET_KEY', !env.STRIPE_WEBHOOK_SECRET && 'STRIPE_WEBHOOK_SECRET'].filter(Boolean);\n    services.push({ service: 'SHOP', status: 'error', detail: `Missing: ${missing.join(', ')}` });\n    svcViolations.push({ type: 'SERVICE_ERROR', service: 'SHOP', detail: `Missing: ${missing.join(', ')}` });\n  }\n\n  // Per-scope TALK readiness: derived from auto-discovered surfaces\n  const allPublicScopes = allChecks.map(c => c.scope).filter(s => s !== '_vanity');\n  const talkScopes = allPublicScopes.map(scope => ({ scope, status: 'ok' }));\n  services.push({ service: 'TALK_SCOPES', status: 'ok', count: talkScopes.length, scopes: talkScopes });\n\n  // \u2500\u2500 INTEL testing (autodiscovered from CANON.json testbanks) \u2500\u2500\n  const INTEL_TTL = parseInt(env.HEALTH_INTEL_TTL_S || '3600', 10) * 1000;\n  const INTEL_CACHE_KEY = 'health:intel:cache';\n\n  let intelCached = {};\n  try {\n    const raw = env.TALK_KV ? await env.TALK_KV.get(INTEL_CACHE_KEY) : null;\n    if (raw) intelCached = JSON.parse(raw);\n  } catch (_) {}\n\n  // Collect all known surface URLs (accessible or cached ok)\n  const accessibleUrls = surfaces\n    .filter(s => s.status === 'ok' || (s.cached && s.status === 'ok'))\n    .map(s => s.url);\n\n  // Find stale/untested surfaces for INTEL testing\n  const intelStale = [];\n  for (const url of accessibleUrls) {\n    const entry = intelCached[url];\n    if (entry && (now - entry.ts) < INTEL_TTL) continue;\n    intelStale.push(url);\n  }\n\n  // Test all stale scopes \u2014 deterministic, all prompts per scope\n  // Cloudflare 50-subrequest limit is the natural ceiling (caught below)\n  const intelToTest = intelStale;\n  const intelFresh = [];\n\n  for (const surfaceUrl of intelToTest) {\n    const canonUrl = surfaceUrl + 'CANON.json';\n    const scope = surfaceUrl.replace(/\\/$/, '').split('/').pop();\n    try {\n      // Fetch CANON.json (~2 subrequests through routing Worker)\n      const resp = await fetch(canonUrl, {\n        headers: { 'User-Agent': 'canonic-health/1.0' },\n      });\n      if (!resp.ok) {\n        intelFresh.push({ url: surfaceUrl, scope, status: 'skip', detail: `CANON.json HTTP ${resp.status}`, ts: now });\n        continue;\n      }\n      const canon = await resp.json();\n\n      // \u2500\u2500 Render pipeline discovery (from CANON.json controls) \u2500\u2500\n      const controls = canon.controls || {};\n      const render = {\n        surface_type: canon.surface_type || 'unknown',\n        view: controls.view || 'html',\n        talk: controls.talk || 'side',\n        gate: controls.gate || undefined,\n        downloads: [],\n      };\n      // Validate downloads (HEAD check each asset URL)\n      const dlList = controls.downloads || [];\n      for (const dl of dlList) {\n        try {\n          const dlUrl = new URL(dl.href, surfaceUrl).href;\n          const dlResp = await fetch(dlUrl, {\n            method: 'HEAD',\n            headers: { 'User-Agent': 'canonic-health/1.0' },\n          });\n          render.downloads.push({\n            label: dl.label, href: dl.href,\n            status: dlResp.ok ? 'ok' : 'error',\n            detail: dlResp.ok ? undefined : `HTTP ${dlResp.status}`,\n          });\n        } catch (e) {\n          render.downloads.push({\n            label: dl.label, href: dl.href,\n            status: 'error', detail: String(e.message || e),\n          });\n        }\n      }\n\n      // CANON.json validation (0 subrequests)\n      if (!canon.systemPrompt || !canon.scope) {\n        intelFresh.push({ url: surfaceUrl, scope, status: 'invalid', detail: 'missing systemPrompt or scope', render, ts: now });\n        continue;\n      }\n\n      // Welcome-in-context check: welcome must exist and not be generic template\n      const welcome = canon.welcome || '';\n      const genericWelcome = `Welcome to **${canon.scope}**`;\n      const welcomeInContext = welcome.length > 0 && (\n        // Custom welcome (longer than generic template + axiom)\n        welcome.length > genericWelcome.length + 80 ||\n        // Or contains markdown links, evidence, or INTEL keywords\n        /\\[.*\\]\\(|evidence|govern|sourced|clinical|trial|NCT|BI-RADS|mCODE/i.test(welcome)\n      );\n\n      // Check for testbank\n      if (!canon.test || !canon.test.prompts || !canon.test.prompts.length) {\n        intelFresh.push({ url: surfaceUrl, scope, status: 'no_test', render, ts: now });\n        continue;\n      }\n\n      // Deterministic: test ALL prompts, aggregate results (governed \u2014 no random selection)\n      const prompts = canon.test.prompts;\n      const promptResults = [];\n      let scopeElapsed = 0;\n      let lastResponse = '';\n\n      let subrequestExhausted = false;\n      for (const fixture of prompts) {\n        try {\n          const chatReq = new Request('https://internal/chat', {\n            method: 'POST',\n            body: JSON.stringify({\n              message: fixture.prompt,\n              scope: canon.scope,\n              system: canon.systemPrompt,\n            }),\n            headers: { 'Content-Type': 'application/json' },\n          });\n\n          const chatStart = Date.now();\n          const chatResp = await chat(chatReq, env);\n          const elapsed_ms = Date.now() - chatStart;\n          scopeElapsed += elapsed_ms;\n\n          if (!chatResp.ok) {\n            promptResults.push({ prompt: fixture.prompt, status: 'chat_error', elapsed_ms });\n            continue;\n          }\n\n          const chatData = await chatResp.json();\n          const responseText = (chatData.message || '').toLowerCase();\n          lastResponse = chatData.message || '';\n\n          const expectHit = fixture.expect.filter(e => responseText.includes(e.toLowerCase())).length;\n          const crossArr = fixture.cross || [];\n          const crossHit = crossArr.filter(c => responseText.includes(c.toLowerCase())).length;\n          const threshold = Math.ceil(fixture.expect.length * 0.5);\n          const pStatus = expectHit >= threshold\n            ? (crossArr.length === 0 || crossHit >= 1 ? 'ok' : 'weak')\n            : 'fail';\n          const missing = fixture.expect.filter(e => !responseText.includes(e.toLowerCase()));\n          const missingCross = crossArr.filter(c => !responseText.includes(c.toLowerCase()));\n\n          promptResults.push({\n            prompt: fixture.prompt, status: pStatus,\n            expect_hit: expectHit, expect_total: fixture.expect.length,\n            cross_hit: crossHit, cross_total: crossArr.length,\n            missing: missing.length ? missing : undefined,\n            missing_cross: missingCross.length ? missingCross : undefined,\n            elapsed_ms,\n          });\n        } catch (promptErr) {\n          const pmsg = String(promptErr.message || promptErr);\n          if (pmsg.includes('Too many subrequests')) { subrequestExhausted = true; break; }\n          promptResults.push({ prompt: fixture.prompt, status: 'chat_error', detail: pmsg });\n        }\n      }\n\n      // Aggregate: scope status = worst prompt result (partial results included)\n      const hasError = promptResults.some(p => p.status === 'chat_error');\n      const hasFail = promptResults.some(p => p.status === 'fail');\n      const hasWeak = promptResults.some(p => p.status === 'weak');\n      let intelStatus = hasFail ? 'fail' : hasWeak ? 'weak' : hasError ? 'chat_error' : 'ok';\n\n      // Aggregate totals across all prompts\n      const totalExpect = promptResults.reduce((s, p) => s + (p.expect_total || 0), 0);\n      const totalExpectHit = promptResults.reduce((s, p) => s + (p.expect_hit || 0), 0);\n      const totalCross = promptResults.reduce((s, p) => s + (p.cross_total || 0), 0);\n      const totalCrossHit = promptResults.reduce((s, p) => s + (p.cross_hit || 0), 0);\n\n      // Downgrade if welcome is generic\n      if (intelStatus === 'ok' && !welcomeInContext) intelStatus = 'weak';\n\n      const detailParts = [];\n      if (intelStatus !== 'ok') {\n        for (const p of promptResults) {\n          if (p.missing) detailParts.push(...p.missing);\n          if (p.missing_cross) detailParts.push(...p.missing_cross.map(c => `cross:${c}`));\n        }\n      }\n      if (!welcomeInContext) detailParts.push('welcome:generic');\n\n      intelFresh.push({\n        url: surfaceUrl, scope, status: promptResults.length ? intelStatus : 'error',\n        render,\n        prompts_tested: promptResults.length, prompts_total: prompts.length,\n        prompts_passed: promptResults.filter(p => p.status === 'ok').length,\n        expect_hit: totalExpectHit, expect_total: totalExpect,\n        cross_hit: totalCrossHit, cross_total: totalCross,\n        welcome_in_context: welcomeInContext,\n        detail: detailParts.length ? `missing: ${[...new Set(detailParts)].join(', ')}` : undefined,\n        prompt_details: promptResults,\n        elapsed_ms: scopeElapsed, ts: now,\n      });\n\n      // If subrequests exhausted mid-scope, stop testing more scopes\n      if (subrequestExhausted) break;\n\n    } catch (e) {\n      const msg = String(e.message || e);\n      if (msg.includes('Too many subrequests')) break;\n      intelFresh.push({ url: surfaceUrl, scope, status: 'error', detail: msg, ts: now });\n    }\n  }\n\n  // Merge fresh INTEL results into cache (skip incomplete \u2014 re-test next call)\n  for (const r of intelFresh) {\n    if (r.prompts_total && r.prompts_tested < r.prompts_total) continue;\n    intelCached[r.url] = r;\n  }\n  for (const key of Object.keys(intelCached)) {\n    if ((now - intelCached[key].ts) > INTEL_TTL * 2) delete intelCached[key];\n  }\n  try {\n    if (env.TALK_KV) {\n      await env.TALK_KV.put(INTEL_CACHE_KEY, JSON.stringify(intelCached), { expirationTtl: Math.ceil(INTEL_TTL * 2 / 1000) });\n    }\n  } catch (_) {}\n\n  // Assemble intel section \u2014 only report actual test results (not no_test/skip)\n  const intelChecks = [];\n  const intelDiscovered = new Set(); // scopes with testbanks (from cache)\n  for (const r of intelFresh) {\n    if (r.status === 'no_test' || r.status === 'skip') continue;\n    intelChecks.push({ scope: r.scope, status: r.status, prompts_tested: r.prompts_tested, prompts_total: r.prompts_total, prompts_passed: r.prompts_passed, expect_hit: r.expect_hit, expect_total: r.expect_total, cross_hit: r.cross_hit, cross_total: r.cross_total, welcome_in_context: r.welcome_in_context, detail: r.detail, prompt_details: r.prompt_details, elapsed_ms: r.elapsed_ms });\n    intelDiscovered.add(r.url);\n  }\n  // Add cached results (tested scopes only)\n  for (const [url, entry] of Object.entries(intelCached)) {\n    if (intelFresh.some(r => r.url === url)) continue;\n    if (entry.status === 'no_test' || entry.status === 'skip') continue;\n    if ((now - entry.ts) < INTEL_TTL) {\n      const age = Math.round((now - entry.ts) / 1000);\n      intelChecks.push({ scope: entry.scope, status: entry.status, prompts_tested: entry.prompts_tested, prompts_total: entry.prompts_total, prompts_passed: entry.prompts_passed, expect_hit: entry.expect_hit, expect_total: entry.expect_total, cross_hit: entry.cross_hit, cross_total: entry.cross_total, welcome_in_context: entry.welcome_in_context, detail: entry.detail, prompt_details: entry.prompt_details, cached: `${age}s ago`, elapsed_ms: entry.elapsed_ms });\n      intelDiscovered.add(url);\n    }\n  }\n\n  const intelTested = intelChecks.filter(c => c.status === 'ok' || c.status === 'weak' || c.status === 'fail').length;\n  const intelPassed = intelChecks.filter(c => c.status === 'ok').length;\n  const intelWeak = intelChecks.filter(c => c.status === 'weak').length;\n  const intelFailed = intelChecks.filter(c => c.status === 'fail').length;\n  const noTestCount = Object.values(intelCached).filter(e => e.status === 'no_test' && (now - e.ts) < INTEL_TTL).length;\n  const intelPending = accessibleUrls.length - intelDiscovered.size - noTestCount;\n\n  // \u2500\u2500 Render pipeline summary (discovered from CANON.json controls) \u2500\u2500\n  const renderChecks = [];\n  for (const [url, entry] of Object.entries(intelCached)) {\n    if (!entry.render) continue;\n    const r = entry.render;\n    const dlBroken = (r.downloads || []).filter(d => d.status !== 'ok');\n    renderChecks.push({\n      scope: entry.scope,\n      surface_type: r.surface_type,\n      view: r.view,\n      talk: r.talk,\n      gate: r.gate || undefined,\n      downloads: r.downloads.length,\n      downloads_ok: r.downloads.filter(d => d.status === 'ok').length,\n      downloads_broken: dlBroken.length ? dlBroken : undefined,\n    });\n  }\n\n  // \u2500\u2500 Assemble response \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const probed = surfaces.filter(s => s.status !== 'private' && s.status !== 'pending');\n  const okCount = probed.filter(s => s.status === 'ok').length;\n  const pending = surfaces.filter(s => s.status === 'pending').length;\n  const privateCount = surfaces.filter(s => s.status === 'private').length;\n  const violations = [\n    ...probed.filter(s => s.status === 'error' || s.status === 'unreachable').map(s => ({\n      type: 'SURFACE_ERROR', scope: s.scope, url: s.url, detail: s.detail,\n    })),\n    ...svcViolations,\n    ...intelChecks.filter(c => c.status === 'fail').map(c => ({\n      type: 'INTEL_FAIL', scope: c.scope, prompt: c.prompt, detail: c.detail,\n    })),\n    ...renderChecks.filter(r => r.downloads_broken?.length).map(r => ({\n      type: 'DOWNLOAD_BROKEN', scope: r.scope,\n      detail: r.downloads_broken.map(d => `${d.label}: ${d.detail}`).join(', '),\n    })),\n  ];\n\n  const svcOk = services.filter(s => s.status === 'ok').length;\n  const svcTotal = services.length;\n  const overall = violations.length > 0 ? 'degraded' : pending > 0 ? 'warming' : 'ok';\n\n  return json({\n    status: overall,\n    provider: env.PROVIDER,\n    model: env.MODEL,\n    ts: now,\n    total: allChecks.length + privateCount,\n    checked: probed.length,\n    ok: okCount,\n    private: privateCount || undefined,\n    pending: pending || undefined,\n    services: { total: svcTotal, ok: svcOk, checks: services },\n    intel: {\n      total: accessibleUrls.length,\n      tested: intelTested,\n      passed: intelPassed,\n      weak: intelWeak || undefined,\n      failed: intelFailed || undefined,\n      pending: intelPending > 0 ? intelPending : undefined,\n      checks: intelChecks.length ? intelChecks : undefined,\n    },\n    render: {\n      total: renderChecks.length,\n      checks: renderChecks.length ? renderChecks : undefined,\n    },\n    sitemap,\n    surfaces,\n    violations: violations.length ? violations : undefined,\n  });\n}\n\nfunction json(data, status = 200) {\n  const headers = { 'Content-Type': 'application/json', ...CORS_DEFAULTS };\n  if (_reqOrigin) headers['Access-Control-Allow-Origin'] = _reqOrigin;\n  return new Response(JSON.stringify(data), { status, headers });\n}\n\nexport default {\n  async fetch(request, env) {\n    const _t0 = Date.now();\n    _reqOrigin = corsOrigin(request, env);\n\n    if (request.method === 'OPTIONS') {\n      const h = { ...CORS_DEFAULTS };\n      if (_reqOrigin) h['Access-Control-Allow-Origin'] = _reqOrigin;\n      return new Response(null, { status: 204, headers: h });\n    }\n\n    const url = new URL(request.url);\n    // KiloCode (and some SDKs) may double-append /v1 when base URL already ends with /v1.\n    // Normalize `/v1/v1/*` -> `/v1/*`.\n    let path = url.pathname;\n    if (path.startsWith('/v1/v1/')) path = path.slice(3);\n    const _ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n    env = envForLane(url.hostname, env);\n\n    if (path === '/health') {\n      const deep = url.searchParams.get('deep') === 'true';\n      if (deep) return deepHealth(env);\n      return json({ status: 'ok', provider: env.PROVIDER, model: env.MODEL, ts: Date.now() });\n    }\n\n    // OpenAI-compatible gateway for Kilo Code and other tooling.\n    // - GET  /v1/models\n    // - POST /v1/chat/completions\n    // - POST /v1/responses (shim)\n    if ((path === '/v1/models' || path === '/models') && request.method === 'GET') {\n      return oaiModels(request, env);\n    }\n    if ((path === '/v1/chat/completions' || path === '/chat/completions') && request.method === 'POST') {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'oai', ip, 120)) return json({ error: 'Rate limited' }, 429);\n      return oaiChatCompletions(request, env);\n    }\n    if ((path === '/v1/responses' || path === '/responses') && request.method === 'POST') {\n      return oaiResponses(request, env);\n    }\n    if (path === '/v1/bakeoff' && request.method === 'POST') {\n      return oaiBakeoff(request, env);\n    }\n\n    if (path === '/auth/config') {\n      return authConfig(env);\n    }\n\n    if (path === '/auth/github' && request.method === 'POST') {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'auth', ip, 20)) return json({ error: 'Rate limited' }, 429);\n      return authGitHub(request, env);\n    }\n\n    if (path === '/auth/session' && request.method === 'GET') {\n      return authSession(request, env);\n    }\n\n    if (path === '/auth/logout' && request.method === 'POST') {\n      return authLogout(request, env);\n    }\n\n    if (path === '/auth/grants' && request.method === 'GET') {\n      return authGrants(request, env);\n    }\n\n    if (path === '/chat' && request.method === 'POST') {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'chat', ip, 60)) return json({ error: 'Rate limited' }, 429);\n      return chat(request, env);\n    }\n\n    if (path === '/email/send' && request.method === 'POST') {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'email', ip, 10)) return json({ error: 'Rate limited' }, 429);\n      return emailSend(request, env);\n    }\n\n    if (path === '/shop/checkout' && request.method === 'POST') {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'checkout', ip, 20)) return json({ error: 'Rate limited' }, 429);\n      return shopCheckout(request, env);\n    }\n\n    if (path === '/shop/webhook/stripe' && request.method === 'POST') {\n      return shopStripeWebhook(request, env);\n    }\n\n    if (path === '/shop/wallet' && request.method === 'GET') {\n      return shopWallet(request, env);\n    }\n\n    // TALK governed portal endpoints\n    if (path === '/talk/ledger' && request.method === 'POST') {\n      return talkLedgerWrite(request, env);\n    }\n    if (path === '/talk/ledger' && request.method === 'GET') {\n      return talkLedgerRead(request, env);\n    }\n    if (path === '/talk/send' && request.method === 'POST') {\n      return talkSend(request, env);\n    }\n    if (path === '/talk/inbox' && request.method === 'GET') {\n      return talkInbox(request, env);\n    }\n    if (path === '/talk/ack' && request.method === 'POST') {\n      return talkAck(request, env);\n    }\n\n    // CONTRIBUTE \u2014 governed contribution ledger (COIN mint)\n    if (path === '/contribute' && request.method === 'POST') {\n      return contribute(request, env);\n    }\n    if (path === '/contribute' && request.method === 'GET') {\n      return contributeRead(request, env);\n    }\n\n    // OMICS \u2014 governed proxy for NCBI E-utilities + PharmGKB (browser CORS bypass)\n    if (path.startsWith('/omics/')) {\n      const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n      if (await checkRate(env, 'omics', ip, 200)) return json({ error: 'Rate limited' }, 429);\n      return omicsProxy(request, env);\n    }\n\n    console.log(JSON.stringify({ ts: new Date().toISOString(), path, method: request.method, ip: _ip, status: 404, latency_ms: Date.now() - _t0 }));\n    return json({ error: 'Not found' }, 404);\n  },\n};\n\n// OMICS proxy \u2014 transparent path-based forwarding for NCBI E-utilities + PharmGKB.\n// Governed in TALK.md: GET /omics/ncbi/*, GET /omics/pharmgkb/*\nconst OMICS_UPSTREAMS = {\n  '/omics/ncbi/':     'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/',\n  '/omics/pharmgkb/': 'https://api.pharmgkb.org/v1/data/',\n};\n\nasync function omicsProxy(request, env) {\n  if (request.method !== 'GET') {\n    return json({ error: 'Method not allowed' }, 405);\n  }\n\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  for (const [prefix, upstream] of Object.entries(OMICS_UPSTREAMS)) {\n    if (path.startsWith(prefix)) {\n      const rest = path.slice(prefix.length);\n      const target = upstream + rest + url.search;\n      const res = await fetch(target, { cf: { cacheTtl: 3600 } });\n      const body = await res.arrayBuffer();\n      const headers = addCors({\n        'Content-Type': res.headers.get('Content-Type') || 'application/json',\n        'Cache-Control': 'public, max-age=3600',\n      }, _reqOrigin);\n\n      // LEDGER: record every proxy query (GOV: OMICS/CANON.md \u2014 every analysis ledgered)\n      const source = prefix.includes('ncbi') ? 'ncbi' : 'pharmgkb';\n      appendToLedger(env, 'OMICS', `OMICS:${source}`, {\n        source,\n        query_path: rest,\n        query_params: url.search,\n        upstream_status: res.status,\n        ip: request.headers.get('CF-Connecting-IP') || 'unknown',\n        work_ref: `omics:${source}:${Date.now()}`\n      }).catch(function() {}); // fire-and-forget\n\n      return new Response(body, { status: res.status, headers });\n    }\n  }\n\n  return json({ error: 'Unknown omics upstream' }, 404);\n}\n\nfunction oaiError(status, message, type = 'invalid_request_error', code = null) {\n  return json({ error: { message, type, param: null, code } }, status);\n}\n\nfunction normalizeResponseInputToMessages(input) {\n  // OpenAI Responses API can pass input as a string or structured list.\n  if (typeof input === 'string') return [{ role: 'user', content: input }];\n  if (!Array.isArray(input)) return null;\n  // Best-effort: allow [{role, content}] or content parts with {text}.\n  const out = [];\n  for (const item of input) {\n    if (!item) continue;\n    if (typeof item.role === 'string' && item.content !== undefined) {\n      const text = coerceContentToText(item.content);\n      if (text) out.push({ role: item.role, content: text });\n      continue;\n    }\n    if (typeof item.text === 'string') {\n      out.push({ role: 'user', content: item.text });\n      continue;\n    }\n    const content = item.content;\n    const text = coerceContentToText(content);\n    if (text) out.push({ role: 'user', content: text });\n  }\n  return out.length ? out : null;\n}\n\nfunction requireGatewayKey(env) {\n  return !!(env && env.CANONIC_API_KEY);\n}\n\nfunction checkGatewayKey(request, env) {\n  if (!requireGatewayKey(env)) return null;\n  const auth = request.headers.get('Authorization') || '';\n  const m = auth.match(/^Bearer\\s+(.+)$/i);\n  const tok = m ? m[1].trim() : '';\n  if (!tok || tok !== String(env.CANONIC_API_KEY)) return 'Unauthorized';\n  return null;\n}\n\nfunction laneProviderFromHostname(hostname) {\n  const h = String(hostname || '').toLowerCase();\n  if (!h) return null;\n  if (h === 'anthropic.canonic.org') return 'anthropic';\n  if (h === 'runpod.canonic.org') return 'runpod';\n  if (h === 'vast.canonic.org') return 'vastai';\n  if (h === 'openai.canonic.org') return 'openai';\n  if (h === 'deepseek.canonic.org') return 'deepseek';\n  return null;\n}\n\nfunction envForLane(hostname, env) {\n  const lane = laneProviderFromHostname(hostname);\n  if (!lane) return env;\n\n  const out = { ...env, LANE_PROVIDER: lane };\n  out.PROVIDER = lane;\n  out.FALLBACK_PROVIDER = lane;\n  out.PROVIDER_CHAIN = lane;\n\n  if (lane === 'runpod') out.MODEL = (env.RUNPOD_MODEL || env.MODEL);\n  if (lane === 'vastai') out.MODEL = (env.VASTAI_MODEL || env.MODEL);\n  if (lane === 'openai') out.MODEL = (env.OPENAI_MODEL || env.MODEL);\n  if (lane === 'deepseek') out.MODEL = (env.DEEPSEEK_MODEL || env.MODEL);\n\n  return out;\n}\n\nfunction completionsUrlFromBase(rawBase) {\n  const raw = String(rawBase || '').trim();\n  if (!raw) return '';\n  const base = raw.replace(/\\/+$/, '');\n  if (base.endsWith('/chat/completions')) return base;\n  if (base.endsWith('/v1')) return base + '/chat/completions';\n  return base + '/v1/chat/completions';\n}\n\nfunction pushGatewayModel(out, seen, entry) {\n  if (!entry || typeof entry !== 'object') return;\n  const id = String(entry.id || '').trim();\n  const provider = String(entry.provider || '').trim();\n  if (!id || !provider) return;\n  if (seen.has(id)) return;\n  seen.add(id);\n  out.push({ ...entry, id, provider });\n}\n\nfunction tokenBoundsForEntry(entry, env) {\n  const provider = String((entry && entry.provider) || '').toUpperCase();\n  const profile = String((entry && entry.profile) || 'talk').toLowerCase();\n  const lo =\n    parseIntEnv(env, `${provider}_TOKENS_MIN`) ??\n    parseIntEnv(env, 'TOKENS_MIN') ??\n    16;\n  const hi =\n    parseIntEnv(env, `${provider}_${profile === 'kilocode' ? 'KILOCODE_TOKENS_MAX' : 'TOKENS_MAX'}`) ??\n    parseIntEnv(env, `${provider}_TOKENS_MAX`) ??\n    (provider === 'RUNPOD' ? 512 : (parseIntEnv(env, 'TOKENS_MAX') ?? 4096));\n  return { lo, hi };\n}\n\nfunction providerHasGatewayConfig(provider, env) {\n  const p = String(provider || '').toLowerCase();\n  if (p === 'anthropic') return !!(env.ANTHROPIC_API_KEY && (env.MODEL || '').trim());\n  if (p === 'openai') return !!(env.OPENAI_API_KEY && ((env.OPENAI_MODEL || env.OPENAI_KILOCODE_MODEL || '').trim()));\n  if (p === 'deepseek') return !!(env.DEEPSEEK_API_KEY && ((env.DEEPSEEK_MODEL || env.DEEPSEEK_KILOCODE_MODEL || '').trim()));\n  if (p === 'runpod') {\n    const hasBase = !!((env.RUNPOD_BASE_URL || env.RUNPOD_KILOCODE_BASE_URL || '').trim());\n    const hasModel = !!((env.RUNPOD_MODEL || env.RUNPOD_KILOCODE_MODEL || '').trim());\n    return !!(env.RUNPOD_API_KEY && hasBase && hasModel);\n  }\n  if (p === 'vastai') {\n    const hasBase = !!((env.VASTAI_BASE_URL || env.VASTAI_KILOCODE_BASE_URL || '').trim());\n    const hasModel = !!((env.VASTAI_MODEL || env.VASTAI_KILOCODE_MODEL || '').trim());\n    return hasBase && hasModel;\n  }\n  return false;\n}\n\nfunction hasAliasConfig(env, prefix) {\n  const keys = ['MODEL_ID', 'PROVIDER', 'UPSTREAM_MODEL', 'BASE_URL'];\n  for (const k of keys) {\n    if (String(env[`${prefix}_${k}`] || '').trim()) return true;\n  }\n  return false;\n}\n\nfunction resolveGatewayAliasEntry(env, spec) {\n  const prefix = String(spec && spec.prefix ? spec.prefix : '').toUpperCase();\n  const profile = spec && spec.profile === 'kilocode' ? 'kilocode' : 'chat';\n  const required = !!(spec && spec.required);\n  const defaultId = String((spec && spec.defaultId) || `canonic-${profile}`).trim();\n  const defaultProviderOrder = Array.isArray(spec && spec.defaultProviderOrder)\n    ? spec.defaultProviderOrder\n    : (profile === 'kilocode'\n      ? ['runpod', 'deepseek', 'openai', 'anthropic', 'vastai']\n      : ['deepseek', 'anthropic', 'openai', 'runpod', 'vastai']);\n  if (!prefix) return null;\n  if (!required && !hasAliasConfig(env, prefix)) return null;\n\n  const requestedProvider = String(env[`${prefix}_PROVIDER`] || defaultProviderOrder[0]).toLowerCase().trim();\n  const provider = providerHasGatewayConfig(requestedProvider, env)\n    ? requestedProvider\n    : (defaultProviderOrder.find(p => providerHasGatewayConfig(p, env)) || requestedProvider);\n\n  const id = String(env[`${prefix}_MODEL_ID`] || defaultId).trim();\n  let upstreamModel = String(env[`${prefix}_UPSTREAM_MODEL`] || '').trim();\n  let baseUrl = String(env[`${prefix}_BASE_URL`] || '').trim();\n\n  if (provider === 'anthropic') {\n    if (!upstreamModel) upstreamModel = profile === 'kilocode'\n      ? String(env.ANTHROPIC_KILOCODE_MODEL || env.MODEL || '').trim()\n      : String(env.MODEL || '').trim();\n    baseUrl = '';\n  } else if (provider === 'openai') {\n    if (!upstreamModel) upstreamModel = profile === 'kilocode'\n      ? String(env.OPENAI_KILOCODE_MODEL || env.OPENAI_MODEL || '').trim()\n      : String(env.OPENAI_MODEL || '').trim();\n    if (!baseUrl) baseUrl = profile === 'kilocode'\n      ? String(env.OPENAI_KILOCODE_BASE_URL || env.OPENAI_BASE_URL || '').trim()\n      : String(env.OPENAI_BASE_URL || '').trim();\n  } else if (provider === 'deepseek') {\n    if (!upstreamModel) upstreamModel = profile === 'kilocode'\n      ? String(env.DEEPSEEK_KILOCODE_MODEL || env.DEEPSEEK_MODEL || '').trim()\n      : String(env.DEEPSEEK_MODEL || '').trim();\n    if (!baseUrl) baseUrl = profile === 'kilocode'\n      ? String(env.DEEPSEEK_KILOCODE_BASE_URL || env.DEEPSEEK_BASE_URL || '').trim()\n      : String(env.DEEPSEEK_BASE_URL || '').trim();\n  } else if (provider === 'runpod') {\n    if (!upstreamModel) upstreamModel = profile === 'kilocode'\n      ? String(env.RUNPOD_KILOCODE_MODEL || env.RUNPOD_MODEL || '').trim()\n      : String(env.RUNPOD_MODEL || '').trim();\n    if (!baseUrl) baseUrl = profile === 'kilocode'\n      ? String(env.RUNPOD_KILOCODE_BASE_URL || env.RUNPOD_BASE_URL || '').trim()\n      : String(env.RUNPOD_BASE_URL || '').trim();\n  } else if (provider === 'vastai') {\n    if (!upstreamModel) upstreamModel = profile === 'kilocode'\n      ? String(env.VASTAI_KILOCODE_MODEL || env.VASTAI_MODEL || '').trim()\n      : String(env.VASTAI_MODEL || '').trim();\n    if (!baseUrl) baseUrl = profile === 'kilocode'\n      ? String(env.VASTAI_KILOCODE_BASE_URL || env.VASTAI_BASE_URL || '').trim()\n      : String(env.VASTAI_BASE_URL || '').trim();\n  }\n\n  if (!id || !upstreamModel) return null;\n  const entry = { id, provider, profile, upstream_model: upstreamModel };\n  if (baseUrl) entry.base_url = baseUrl;\n  return entry;\n}\n\nfunction listGatewayModels(env) {\n  const out = [];\n  const seen = new Set();\n  const specs = [\n    {\n      prefix: 'CHAT',\n      profile: 'chat',\n      defaultId: 'canonic-chat',\n      required: true,\n      defaultProviderOrder: ['deepseek', 'anthropic', 'openai', 'runpod', 'vastai'],\n    },\n    {\n      prefix: 'KILOCODE',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode',\n      required: true,\n      defaultProviderOrder: ['runpod', 'deepseek', 'openai', 'anthropic', 'vastai'],\n    },\n    {\n      prefix: 'CHAT_COMMERCIAL',\n      profile: 'chat',\n      defaultId: 'canonic-chat-commercial',\n      defaultProviderOrder: ['deepseek', 'anthropic', 'openai', 'runpod', 'vastai'],\n    },\n    {\n      prefix: 'CHAT_COMMERCIAL_OPENAI',\n      profile: 'chat',\n      defaultId: 'canonic-chat-commercial-openai',\n      defaultProviderOrder: ['openai', 'deepseek', 'anthropic', 'runpod', 'vastai'],\n    },\n    {\n      prefix: 'CHAT_COMMERCIAL_ANTHROPIC',\n      profile: 'chat',\n      defaultId: 'canonic-chat-commercial-anthropic',\n      defaultProviderOrder: ['anthropic', 'deepseek', 'openai', 'runpod', 'vastai'],\n    },\n    {\n      prefix: 'CHAT_OPENSOURCE_RUNPOD',\n      profile: 'chat',\n      defaultId: 'canonic-chat-opensource-runpod',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_OPENSOURCE_VAST',\n      profile: 'chat',\n      defaultId: 'canonic-chat-opensource-vast',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_RUNPOD_DEEPSEEK',\n      profile: 'chat',\n      defaultId: 'canonic-chat-runpod-deepseek',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_RUNPOD_QWEN',\n      profile: 'chat',\n      defaultId: 'canonic-chat-runpod-qwen',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_RUNPOD_MISTRAL',\n      profile: 'chat',\n      defaultId: 'canonic-chat-runpod-mistral',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_RUNPOD_LLAMA',\n      profile: 'chat',\n      defaultId: 'canonic-chat-runpod-llama',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_RUNPOD_GLM',\n      profile: 'chat',\n      defaultId: 'canonic-chat-runpod-glm',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_VAST_DEEPSEEK',\n      profile: 'chat',\n      defaultId: 'canonic-chat-vast-deepseek',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_VAST_QWEN',\n      profile: 'chat',\n      defaultId: 'canonic-chat-vast-qwen',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_VAST_MISTRAL',\n      profile: 'chat',\n      defaultId: 'canonic-chat-vast-mistral',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_VAST_LLAMA',\n      profile: 'chat',\n      defaultId: 'canonic-chat-vast-llama',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'CHAT_VAST_GLM',\n      profile: 'chat',\n      defaultId: 'canonic-chat-vast-glm',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_COMMERCIAL',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-commercial',\n      defaultProviderOrder: ['openai', 'deepseek', 'anthropic', 'runpod', 'vastai'],\n    },\n    {\n      prefix: 'KILOCODE_OPENSOURCE_RUNPOD',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-opensource-runpod',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_OPENSOURCE_VAST',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-opensource-vast',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_RUNPOD_DEEPSEEK',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-runpod-deepseek',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_RUNPOD_QWEN',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-runpod-qwen',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_RUNPOD_GLM',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-runpod-glm',\n      defaultProviderOrder: ['runpod', 'vastai', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_VAST_DEEPSEEK',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-vast-deepseek',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_VAST_QWEN',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-vast-qwen',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n    {\n      prefix: 'KILOCODE_VAST_GLM',\n      profile: 'kilocode',\n      defaultId: 'canonic-kilocode-vast-glm',\n      defaultProviderOrder: ['vastai', 'runpod', 'deepseek', 'openai', 'anthropic'],\n    },\n  ];\n\n  for (const spec of specs) {\n    const entry = resolveGatewayAliasEntry(env, spec);\n    if (entry) pushGatewayModel(out, seen, entry);\n  }\n\n  const lane = (env.LANE_PROVIDER || '').trim();\n  if (lane) return out.filter(m => m.provider === lane);\n  return out;\n}\n\nfunction runpodEndpointIdFromBaseUrl(baseUrl) {\n  if (!baseUrl) return null;\n  const m = String(baseUrl).match(/\\/v2\\/([^/]+)\\/openai\\/v1\\/?$/);\n  return m ? m[1] : null;\n}\n\nfunction isRunpodProxyBaseUrl(baseUrl) {\n  if (!baseUrl) return false;\n  const b = String(baseUrl).replace(/\\/+$/, '');\n  return /\\.proxy\\.runpod\\.net\\/v1$/.test(b);\n}\n\nasync function runpodProxyReady(baseUrl, env) {\n  const b = String(baseUrl || '').replace(/\\/+$/, '');\n  if (!b) return null;\n  try {\n    const r = await fetchWithTimeout(b + '/models', {\n      headers: { 'Accept': 'application/json' },\n    }, parseIntEnv(env, 'RUNPOD_HEALTH_TIMEOUT_MS') ?? 2000);\n    return { ok: r.ok, status: r.status };\n  } catch {\n    return null;\n  }\n}\n\nasync function runpodHealth(endpointId, env) {\n  const id = String(endpointId || '').trim();\n  if (!id) return null;\n  // Use the EDGE /health as CANON. Keep this bounded and fail-soft.\n  try {\n    const r = await fetchWithTimeout(`https://api.runpod.ai/v2/${id}/health`, {\n      headers: {\n        'Accept': 'application/json',\n        // Runpod health accepts raw key. (Bearer also often works, but keep canonical.)\n        'Authorization': String(env.RUNPOD_API_KEY || ''),\n      },\n    }, parseIntEnv(env, 'RUNPOD_HEALTH_TIMEOUT_MS') ?? 2000);\n    if (!r.ok) return null;\n    return await r.json();\n  } catch {\n    return null;\n  }\n}\n\n// \u2500\u2500 Preflight orchestrator (GOV: TALK/TALK.md \u00A7 Preflight) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function preflightAllProviders(env) {\n  const chain = env.PROVIDER_CHAIN\n    ? String(env.PROVIDER_CHAIN).split(',').map(s => s.trim()).filter(Boolean)\n    : [env.PROVIDER];\n\n  const seen = new Set();\n  const toCheck = [];\n\n  // Primary provider always checked when global toggle is on\n  const primaryName = env.PROVIDER;\n  if (primaryName && PROVIDERS[primaryName] && PROVIDERS[primaryName].preflight) {\n    seen.add(primaryName);\n    toCheck.push({ name: primaryName, provider: PROVIDERS[primaryName] });\n  }\n\n  // Chain providers checked per their enable flag\n  for (const name of chain) {\n    if (seen.has(name)) continue;\n    seen.add(name);\n    const p = PROVIDERS[name];\n    if (!p || !p.preflight) continue;\n    const envKey = `${name.toUpperCase()}_PREFLIGHT_HEALTH`;\n    if (!boolEnv(env, envKey, false)) continue;\n    toCheck.push({ name, provider: p });\n  }\n\n  const results = {};\n  const settled = await Promise.allSettled(\n    toCheck.map(async ({ name, provider }) => {\n      const result = await provider.preflight(env);\n      return { name, result };\n    })\n  );\n\n  for (const s of settled) {\n    if (s.status === 'fulfilled') {\n      results[s.value.name] = s.value.result;\n    } else {\n      results['unknown'] = { status: 'error', key_valid: false, model: null, error: String(s.reason), elapsed_ms: 0 };\n    }\n  }\n\n  const statuses = Object.values(results).map(r => r.status);\n  const overall = statuses.every(s => s === 'ok')\n    ? 'ok'\n    : statuses.some(s => s === 'ok')\n      ? 'degraded'\n      : 'error';\n\n  return { service: 'TALK_PREFLIGHT', status: overall, providers: results };\n}\n\nasync function oaiModels(request, env) {\n  const gateErr = checkGatewayKey(request, env);\n  if (gateErr) return oaiError(401, gateErr, 'authentication_error');\n\n  const models = listGatewayModels(env).map(m => ({\n    id: m.id,\n    object: 'model',\n    owned_by: 'canonic',\n  }));\n  return json({ object: 'list', data: models });\n}\n\nasync function oaiResponses(request, env) {\n  // Minimal OpenAI Responses API shim for clients that prefer /v1/responses.\n  // We translate to chat.completions internally and then wrap the result.\n  const gateErr = checkGatewayKey(request, env);\n  if (gateErr) return oaiError(401, gateErr, 'authentication_error');\n\n  let body;\n  try { body = await request.json(); }\n  catch { return oaiError(400, 'Invalid JSON'); }\n\n  const model = (body && body.model ? String(body.model) : '').trim();\n  const audience = String(\n    (body && (body.audience || body.suite)) || '',\n  ).toLowerCase().trim();\n  const randomize = !!(body && body.randomize_model);\n  const autoAssignAudience = (audience === 'user' || audience === 'patient' || audience === 'dev' || audience === 'experiment');\n  if (!model && !(randomize || autoAssignAudience)) return oaiError(400, 'Missing model');\n\n  // Prefer explicit messages if provided; else derive from input.\n  let messages = null;\n  if (body && Array.isArray(body.messages) && body.messages.length) {\n    messages = body.messages;\n  } else if (body && body.input !== undefined) {\n    messages = normalizeResponseInputToMessages(body.input);\n  }\n  if (!messages || !messages.length) return oaiError(400, 'Missing messages/input');\n\n  // Map max_output_tokens -> max_tokens.\n  const chatBody = {\n    messages,\n    max_tokens: body.max_output_tokens ?? body.max_tokens,\n    temperature: body.temperature,\n    top_p: body.top_p,\n    presence_penalty: body.presence_penalty,\n    frequency_penalty: body.frequency_penalty,\n    stop: body.stop,\n    seed: body.seed,\n    stream: false,\n    n: 1,\n  };\n  if (model) chatBody.model = model;\n  if (audience) chatBody.audience = audience;\n  if (randomize) chatBody.randomize_model = true;\n  if (body && body.user_id !== undefined) chatBody.user_id = body.user_id;\n  if (body && body.patient_id !== undefined) chatBody.patient_id = body.patient_id;\n  if (body && body.session_id !== undefined) chatBody.session_id = body.session_id;\n\n  // Reuse the chat.completions implementation (governance + routing).\n  const r2 = new Request('https://api.canonic.org/v1/chat/completions', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      // Preserve any auth header for optional gateway key enforcement.\n      'Authorization': request.headers.get('Authorization') || '',\n    },\n    body: JSON.stringify(chatBody),\n  });\n  const chatRes = await oaiChatCompletions(r2, env);\n  const text = await chatRes.text();\n  if (chatRes.status !== 200) {\n    // Pass through OpenAI-style error payload for compatibility.\n    return new Response(text, { status: chatRes.status, headers: addCors(chatRes.headers) });\n  }\n\n  let data;\n  try { data = JSON.parse(text); } catch { return oaiError(502, 'Upstream returned invalid JSON', 'api_error'); }\n  const content = data && data.choices && data.choices[0] && data.choices[0].message\n    ? String(data.choices[0].message.content || '')\n    : '';\n\n  const usage = data && data.usage ? data.usage : null;\n  const out = {\n    id: 'resp-canonic-' + (data.id ? String(data.id).replace(/^chatcmpl-/, '') : String(Date.now())),\n    object: 'response',\n    created: Math.floor(Date.now() / 1000),\n    model,\n    output: [\n      {\n        type: 'message',\n        role: 'assistant',\n        content: [{ type: 'output_text', text: content }],\n      },\n    ],\n    // Some clients look for a convenience string.\n    output_text: content,\n    usage,\n  };\n\n  const h = addCors({ 'Content-Type': 'application/json' });\n  // Preserve CANONIC trace headers if present.\n  const trace = chatRes.headers.get('x-canonic-trace-id');\n  if (trace) h.set('x-canonic-trace-id', trace);\n  const prof = chatRes.headers.get('x-canonic-model-profile');\n  if (prof) h.set('x-canonic-model-profile', prof);\n  const elapsed = chatRes.headers.get('x-canonic-upstream-elapsed-ms');\n  if (elapsed) h.set('x-canonic-upstream-elapsed-ms', elapsed);\n  return new Response(JSON.stringify(out), { status: 200, headers: h });\n}\n\nfunction stableIndexFromKey(key, len) {\n  const n = Math.max(1, parseInt(len, 10) || 1);\n  const s = String(key || '');\n  if (!s) {\n    if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n      const a = new Uint32Array(1);\n      crypto.getRandomValues(a);\n      return a[0] % n;\n    }\n    return Math.floor(Math.random() * n);\n  }\n  let h = 2166136261;\n  for (let i = 0; i < s.length; i++) {\n    h ^= s.charCodeAt(i);\n    h = Math.imul(h, 16777619);\n  }\n  return (h >>> 0) % n;\n}\n\nfunction resolveChatRequestedModel(body, env, registry) {\n  const requested = (body && body.model ? String(body.model) : '').trim();\n  if (requested) return { model: requested, assigned: false };\n\n  const audience = String(\n    (body && (body.audience || body.suite)) || '',\n  ).toLowerCase().trim();\n  const randomize = !!(body && body.randomize_model);\n  const autoAssignAudience = (audience === 'user' || audience === 'patient' || audience === 'dev' || audience === 'experiment');\n  if (!(autoAssignAudience || randomize)) return { model: '', assigned: false };\n\n  const configured =\n    audience === 'dev' ? parseModelCsv(env.BAKEOFF_DEV_MODELS)\n      : (audience === 'user' || audience === 'patient') ? parseModelCsv(env.BAKEOFF_USER_MODELS)\n        : parseModelCsv(env.BAKEOFF_EXPERIMENT_MODELS);\n  const fallback = registry.filter(m => m.profile === 'chat').map(m => m.id);\n  const source = configured.length ? configured : fallback;\n  const known = new Set(registry.map(m => m.id));\n  const candidates = source.filter(id => known.has(id));\n  if (!candidates.length) return { model: '', assigned: false, error: 'No randomized models configured' };\n\n  const key = String(\n    (body && (body.patient_id || body.user_id || body.session_id)) ||\n    '',\n  ).trim();\n  const idx = stableIndexFromKey(key, candidates.length);\n  return { model: candidates[idx], assigned: true };\n}\n\nasync function oaiChatCompletions(request, env) {\n  const gateErr = checkGatewayKey(request, env);\n  if (gateErr) return oaiError(401, gateErr, 'authentication_error');\n\n  let body;\n  try { body = await request.json(); }\n  catch { return oaiError(400, 'Invalid JSON'); }\n\n  const messagesIn = body && Array.isArray(body.messages) ? body.messages : null;\n  if (!messagesIn || !messagesIn.length) return oaiError(400, 'Missing messages');\n\n  const reg = listGatewayModels(env);\n  const selection = resolveChatRequestedModel(body, env, reg);\n  if (selection.error) return oaiError(400, selection.error);\n  const model = selection.model;\n  if (!model) return oaiError(400, 'Missing model');\n  const entry = reg.find(m => m.id === model) || null;\n  if (!entry) return oaiError(400, `Unknown model: ${model || '(empty)'}`, 'invalid_request_error', 'model_not_found');\n  const upstreamModel = (entry.upstream_model || entry.id || '').trim();\n  if (!upstreamModel) return oaiError(500, `Model misconfigured: ${entry.id}`);\n\n  // Governance clamps.\n  const wantMax = Number.isFinite(body.max_tokens) ? parseInt(body.max_tokens, 10) : null;\n  const { lo, hi } = tokenBoundsForEntry(entry, env);\n  const max_tokens = clampInt(wantMax ?? hi, lo, hi);\n\n  const stream = !!(body && body.stream);\n  if (body && body.n && parseInt(body.n, 10) !== 1) return oaiError(400, 'Only n=1 is supported');\n\n  // Trim to keep payload bounded.\n  const messages = messagesIn.slice(-40).map(m => ({\n    role: String(m.role || '').trim(),\n    content: coerceContentToText(m.content),\n  })).filter(m => m.role && m.content);\n  if (!messages.length) return oaiError(400, 'No valid messages');\n\n  const timeout_ms = parseIntEnv(env, 'OAI_GATEWAY_TIMEOUT_MS') ?? (stream ? 600000 : 120000);\n  const trace_id = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());\n  const started = Date.now();\n\n  const allowed = ['temperature', 'top_p', 'presence_penalty', 'frequency_penalty', 'stop', 'seed'];\n  const pass = {};\n  for (const k of allowed) {\n    if (body && body[k] !== undefined) pass[k] = body[k];\n  }\n\n  if (entry.provider === 'anthropic') {\n    if (!env.ANTHROPIC_API_KEY) return oaiError(500, 'ANTHROPIC_API_KEY not configured');\n\n    // OpenAI -> Anthropic translation:\n    // - system: concatenate any system messages\n    // - messages: keep user/assistant only\n    const sys = messagesIn\n      .filter(m => m && m.role === 'system')\n      .map(m => coerceContentToText(m.content))\n      .filter(Boolean)\n      .join('\\n\\n');\n    const anthMessages = messagesIn\n      .filter(m => m && (m.role === 'user' || m.role === 'assistant'))\n      .slice(-40)\n      .map(m => ({ role: m.role, content: coerceContentToText(m.content) }))\n      .filter(m => m.role && m.content);\n    if (!anthMessages.length) return oaiError(400, 'No valid user/assistant messages');\n\n    let res;\n    try {\n      res = await fetchWithTimeout(PROVIDERS.anthropic.url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-api-key': env.ANTHROPIC_API_KEY,\n          'anthropic-version': env.ANTHROPIC_VERSION,\n        },\n        body: JSON.stringify({\n          model: upstreamModel,\n          max_tokens,\n          system: sys || undefined,\n          messages: anthMessages,\n        }),\n      }, parseIntEnv(env, 'OAI_GATEWAY_TIMEOUT_MS') ?? 25000);\n    } catch (e) {\n      return oaiError(502, `Upstream error: ${clampString(String(e && e.message ? e.message : e), 180)}`, 'api_error');\n    }\n    const text = await res.text();\n    if (!res.ok) {\n      const safe = clampString(redactSecrets(text), 900);\n      return oaiError(502, `Anthropic ${res.status}: ${safe}`, 'api_error');\n    }\n    let data;\n    try { data = JSON.parse(text); } catch { return oaiError(502, 'Anthropic returned invalid JSON', 'api_error'); }\n    const content = data && data.content && data.content[0] && data.content[0].text ? String(data.content[0].text) : '';\n\n    const h = addCors({ 'Content-Type': 'application/json' });\n    h.set('x-canonic-trace-id', trace_id);\n    h.set('x-canonic-model-profile', entry.profile || 'anthropic');\n    h.set('x-canonic-upstream-elapsed-ms', String(Date.now() - started));\n    if (selection.assigned) h.set('x-canonic-assigned-model', model);\n\n    // Anthropic -> OpenAI chat.completions schema (minimal).\n    const out = {\n      id: 'chatcmpl-canonic-' + trace_id,\n      object: 'chat.completion',\n      created: Math.floor(Date.now() / 1000),\n      model,\n      choices: [\n        {\n          index: 0,\n          message: { role: 'assistant', content },\n          finish_reason: 'stop',\n          logprobs: null,\n        },\n      ],\n      usage: null,\n    };\n\n    // Some clients require streaming; provide a single-chunk SSE wrapper.\n    if (stream) {\n      const sh = addCors({\n        'Content-Type': 'text/event-stream; charset=utf-8',\n        'Cache-Control': 'no-cache',\n      });\n      sh.set('x-canonic-trace-id', trace_id);\n      sh.set('x-canonic-model-profile', entry.profile || 'anthropic');\n      sh.set('x-canonic-upstream-elapsed-ms', String(Date.now() - started));\n      if (selection.assigned) sh.set('x-canonic-assigned-model', model);\n      const chunk = {\n        id: out.id,\n        object: 'chat.completion.chunk',\n        created: out.created,\n        model: out.model,\n        choices: [{ index: 0, delta: { role: 'assistant', content }, finish_reason: null }],\n      };\n      const rs = new ReadableStream({\n        start(controller) {\n          controller.enqueue(new TextEncoder().encode(`data: ${JSON.stringify(chunk)}\\n\\n`));\n          controller.enqueue(new TextEncoder().encode(`data: [DONE]\\n\\n`));\n          controller.close();\n        },\n      });\n      return new Response(rs, { status: 200, headers: sh });\n    }\n\n    return new Response(JSON.stringify(out), { status: 200, headers: h });\n  }\n\n  if (entry.provider === 'openai' || entry.provider === 'deepseek') {\n    const p = PROVIDERS[entry.provider];\n    if (!p) return oaiError(500, `Unsupported provider for this model: ${entry.provider}`);\n\n    const providerError = p.validate?.(env);\n    if (providerError) return oaiError(500, providerError, 'configuration_error');\n\n    const providerUrl = entry.base_url\n      ? completionsUrlFromBase(entry.base_url)\n      : (typeof p.url === 'function' ? p.url(env) : p.url);\n    if (!providerUrl) return oaiError(500, `Provider URL misconfigured: ${entry.provider}`, 'configuration_error');\n\n    const payload = { model: upstreamModel, messages, max_tokens, stream, ...pass };\n    const headers = { 'Content-Type': 'application/json' };\n    if (entry.provider === 'openai') headers.Authorization = `Bearer ${env.OPENAI_API_KEY}`;\n    if (entry.provider === 'deepseek') headers.Authorization = `Bearer ${env.DEEPSEEK_API_KEY}`;\n\n    let res;\n    try {\n      res = await fetchWithTimeout(providerUrl, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(payload),\n      }, timeout_ms);\n    } catch (e) {\n      return oaiError(502, `Upstream error: ${clampString(String(e && e.message ? e.message : e), 180)}`, 'api_error');\n    }\n\n    const h = addCors(res.headers);\n    h.set('x-canonic-trace-id', trace_id);\n    h.set('x-canonic-model-profile', entry.profile || entry.provider);\n    h.set('x-canonic-upstream-elapsed-ms', String(Date.now() - started));\n    if (selection.assigned) h.set('x-canonic-assigned-model', model);\n\n    if (stream) return new Response(res.body, { status: res.status, headers: h });\n\n    const text = await res.text();\n    if (!res.ok) {\n      const safe = clampString(redactSecrets(text), 900);\n      const up = entry.provider === 'openai' ? 'OpenAI' : 'DeepSeek';\n      return oaiError(502, `${up} ${res.status}: ${safe}`, 'api_error');\n    }\n    return new Response(text, { status: 200, headers: h });\n  }\n\n  // OpenAI-compatible upstream route (runpod or vastai).\n  const baseUrl = (entry.base_url || '').replace(/\\/+$/, '');\n  if (!baseUrl) return oaiError(500, `Model misconfigured: ${entry.id}`);\n\n  if (entry.provider === 'runpod') {\n    if (!env.RUNPOD_API_KEY) return oaiError(500, 'RUNPOD_API_KEY not configured');\n\n    // Preflight readiness to avoid long hangs when upstream isn't ready.\n    if ((parseIntEnv(env, 'RUNPOD_PREFLIGHT_HEALTH') ?? 1) === 1) {\n      const endpointId = runpodEndpointIdFromBaseUrl(baseUrl);\n      if (endpointId) {\n        // Runpod serverless.\n        const h = await runpodHealth(endpointId, env);\n        const w = h && h.workers ? h.workers : null;\n        if (w) {\n          const ready = w.ready || 0;\n          const throttled = w.throttled || 0;\n          if (ready < 1 || throttled > 0) {\n            const resp = oaiError(503, `Model warming up (ready=${ready}, throttled=${throttled}). Try again shortly.`, 'api_error');\n            const hh = addCors(resp.headers);\n            hh.set('Retry-After', '10');\n            return new Response(resp.body, { status: resp.status, headers: hh });\n          }\n        }\n      } else if (isRunpodProxyBaseUrl(baseUrl)) {\n        // Runpod pod proxy: treat /v1/models as readiness.\n        const pr = await runpodProxyReady(baseUrl, env);\n        if (!pr || !pr.ok) {\n          const resp = oaiError(503, `Model warming up (proxy_ready=${pr ? pr.status : 'no_response'}). Try again shortly.`, 'api_error');\n          const hh = addCors(resp.headers);\n          hh.set('Retry-After', '10');\n          return new Response(resp.body, { status: resp.status, headers: hh });\n        }\n      }\n    }\n  }\n\n  const payload = { model: upstreamModel, messages, max_tokens, stream, ...pass };\n\n  const headers = { 'Content-Type': 'application/json' };\n  if (entry.provider === 'runpod') {\n    headers.Authorization = 'Bearer ' + env.RUNPOD_API_KEY;\n  } else if (entry.provider === 'vastai') {\n    const key = (env.VASTAI_API_KEY || env.VLLM_API_KEY || '').trim();\n    if (key) headers.Authorization = 'Bearer ' + key;\n  } else {\n    return oaiError(500, `Unsupported provider for this model: ${entry.provider}`);\n  }\n\n  let res;\n  try {\n    const upstreamUrl = baseUrl + '/chat/completions';\n    res = await fetchWithTimeout(upstreamUrl, {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(payload),\n    }, timeout_ms);\n  } catch (e) {\n    return oaiError(502, `Upstream error: ${clampString(String(e && e.message ? e.message : e), 180)}`, 'api_error');\n  }\n\n  const h = addCors(res.headers);\n  h.set('x-canonic-trace-id', trace_id);\n  h.set('x-canonic-model-profile', entry.profile);\n  h.set('x-canonic-upstream-elapsed-ms', String(Date.now() - started));\n  if (selection.assigned) h.set('x-canonic-assigned-model', model);\n\n  // Streaming: pass-through SSE body from upstream (OpenAI-compatible).\n  if (stream) {\n    return new Response(res.body, { status: res.status, headers: h });\n  }\n\n  const text = await res.text();\n  if (!res.ok) {\n    const safe = clampString(redactSecrets(text), 900);\n    const up = entry.provider === 'runpod' ? 'Runpod' : 'VastAI';\n    return oaiError(502, `${up} ${res.status}: ${safe}`, 'api_error');\n  }\n\n  // Preserve OpenAI-compatible JSON schema from upstream.\n  return new Response(text, { status: 200, headers: h });\n}\n\nasync function callGatewayModel(entry, body, env, trace_id) {\n  const started = Date.now();\n  const model = entry.id;\n  const upstreamModel = (entry.upstream_model || model || '').trim();\n  if (!upstreamModel) {\n    return { model, ok: false, status: 500, error: `Model misconfigured: ${model}`, elapsed_ms: Date.now() - started };\n  }\n\n  // Governance clamps.\n  const wantMax = Number.isFinite(body.max_tokens) ? parseInt(body.max_tokens, 10) : null;\n  const { lo, hi } = tokenBoundsForEntry(entry, env);\n  const max_tokens = clampInt(wantMax ?? hi, lo, hi);\n\n  const messagesIn = body && Array.isArray(body.messages) ? body.messages : null;\n  if (!messagesIn || !messagesIn.length) {\n    return { model, ok: false, status: 400, error: 'Missing messages', elapsed_ms: Date.now() - started };\n  }\n  const messages = messagesIn.slice(-40).map(m => ({\n    role: String(m.role || '').trim(),\n    content: coerceContentToText(m.content),\n  })).filter(m => m.role && m.content);\n  if (!messages.length) {\n    return { model, ok: false, status: 400, error: 'No valid messages', elapsed_ms: Date.now() - started };\n  }\n\n  const allowed = ['temperature', 'top_p', 'presence_penalty', 'frequency_penalty', 'stop', 'seed'];\n  const pass = {};\n  for (const k of allowed) {\n    if (body && body[k] !== undefined) pass[k] = body[k];\n  }\n\n  const gov_pre = {\n    provider: entry.provider,\n    profile: entry.profile || null,\n    model,\n    upstream_model: upstreamModel,\n    max_tokens,\n    tokens_min: lo,\n    tokens_max: hi,\n  };\n\n  if (entry.provider === 'anthropic') {\n    if (!env.ANTHROPIC_API_KEY) {\n      return { model, ok: false, status: 500, error: 'ANTHROPIC_API_KEY not configured', gov_pre, elapsed_ms: Date.now() - started };\n    }\n\n    const sys = messagesIn\n      .filter(m => m && m.role === 'system')\n      .map(m => coerceContentToText(m.content))\n      .filter(Boolean)\n      .join('\\n\\n');\n    const anthMessages = messagesIn\n      .filter(m => m && (m.role === 'user' || m.role === 'assistant'))\n      .slice(-40)\n      .map(m => ({ role: m.role, content: coerceContentToText(m.content) }))\n      .filter(m => m.role && m.content);\n    if (!anthMessages.length) {\n      return { model, ok: false, status: 400, error: 'No valid user/assistant messages', gov_pre, elapsed_ms: Date.now() - started };\n    }\n\n    const timeout_ms = parseIntEnv(env, 'BAKEOFF_TIMEOUT_MS') ?? 60000;\n    try {\n      const res = await fetchWithTimeout(PROVIDERS.anthropic.url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'x-api-key': env.ANTHROPIC_API_KEY,\n          'anthropic-version': env.ANTHROPIC_VERSION,\n        },\n        body: JSON.stringify({\n          model: upstreamModel,\n          max_tokens,\n          system: sys || undefined,\n          messages: anthMessages,\n          // Best-effort mapping.\n          temperature: pass.temperature,\n          top_p: pass.top_p,\n          stop_sequences: pass.stop ? (Array.isArray(pass.stop) ? pass.stop : [pass.stop]) : undefined,\n        }),\n      }, timeout_ms);\n\n      const text = await res.text();\n      if (!res.ok) {\n        return { model, ok: false, status: 502, error: `Anthropic ${res.status}: ${clampString(redactSecrets(text), 600)}`, gov_pre, elapsed_ms: Date.now() - started };\n      }\n      const data = JSON.parse(text);\n      const content = data && data.content && data.content[0] && data.content[0].text ? String(data.content[0].text) : '';\n      return {\n        model,\n        ok: true,\n        status: 200,\n        content,\n        usage: data && data.usage ? data.usage : null,\n        gov_pre,\n        gov_post: { ok: true, elapsed_ms: Date.now() - started, trace_id },\n        elapsed_ms: Date.now() - started,\n      };\n    } catch (e) {\n      return { model, ok: false, status: 502, error: `Anthropic error: ${clampString(String(e && e.message ? e.message : e), 180)}`, gov_pre, elapsed_ms: Date.now() - started };\n    }\n  }\n\n  if (entry.provider === 'openai' || entry.provider === 'deepseek') {\n    const p = PROVIDERS[entry.provider];\n    if (!p) return { model, ok: false, status: 500, error: `Unsupported provider: ${entry.provider}`, gov_pre, elapsed_ms: Date.now() - started };\n\n    const providerError = p.validate?.(env);\n    if (providerError) return { model, ok: false, status: 500, error: providerError, gov_pre, elapsed_ms: Date.now() - started };\n\n    const providerUrl = entry.base_url\n      ? completionsUrlFromBase(entry.base_url)\n      : (typeof p.url === 'function' ? p.url(env) : p.url);\n    if (!providerUrl) return { model, ok: false, status: 500, error: `Provider URL misconfigured: ${entry.provider}`, gov_pre, elapsed_ms: Date.now() - started };\n\n    const timeout_ms = parseIntEnv(env, 'BAKEOFF_TIMEOUT_MS') ?? 120000;\n    const payload = { model: upstreamModel, messages, max_tokens, stream: false, ...pass };\n\n    const headers = { 'Content-Type': 'application/json' };\n    if (entry.provider === 'openai') headers.Authorization = `Bearer ${env.OPENAI_API_KEY}`;\n    if (entry.provider === 'deepseek') headers.Authorization = `Bearer ${env.DEEPSEEK_API_KEY}`;\n\n    try {\n      const res = await fetchWithTimeout(providerUrl, {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(payload),\n      }, timeout_ms);\n      const text = await res.text();\n      if (!res.ok) {\n        const up = entry.provider === 'openai' ? 'OpenAI' : 'DeepSeek';\n        return { model, ok: false, status: 502, error: `${up} ${res.status}: ${clampString(redactSecrets(text), 600)}`, gov_pre, elapsed_ms: Date.now() - started };\n      }\n      const data = JSON.parse(text);\n      const content = data && data.choices && data.choices[0] && data.choices[0].message ? data.choices[0].message.content : '';\n      return {\n        model,\n        ok: true,\n        status: 200,\n        content: typeof content === 'string' ? content : '',\n        usage: data && data.usage ? data.usage : null,\n        gov_pre,\n        gov_post: { ok: true, elapsed_ms: Date.now() - started, trace_id },\n        elapsed_ms: Date.now() - started,\n      };\n    } catch (e) {\n      const up = entry.provider === 'openai' ? 'OpenAI' : 'DeepSeek';\n      return { model, ok: false, status: 502, error: `${up} error: ${clampString(String(e && e.message ? e.message : e), 180)}`, gov_pre, elapsed_ms: Date.now() - started };\n    }\n  }\n\n  // OpenAI-compatible provider (runpod or vastai).\n  const baseUrl = (entry.base_url || '').replace(/\\/+$/, '');\n  if (!baseUrl) return { model, ok: false, status: 500, error: `Model misconfigured: ${model}`, gov_pre, elapsed_ms: Date.now() - started };\n\n  const providerName = entry.provider;\n  if (providerName === 'runpod' && !env.RUNPOD_API_KEY) {\n    return { model, ok: false, status: 500, error: 'RUNPOD_API_KEY not configured', gov_pre, elapsed_ms: Date.now() - started };\n  }\n\n  // Preflight /health only for Runpod serverless.\n  if (providerName === 'runpod') {\n    const endpointId = runpodEndpointIdFromBaseUrl(baseUrl);\n    if (endpointId) {\n      const h = await runpodHealth(endpointId, env);\n      const w = h && h.workers ? h.workers : null;\n      if (w) {\n        const ready = w.ready || 0;\n        const throttled = w.throttled || 0;\n        if (ready < 1 || throttled > 0) {\n          return { model, ok: false, status: 503, error: `warming (ready=${ready}, throttled=${throttled})`, gov_pre, health: h, elapsed_ms: Date.now() - started };\n        }\n      }\n    } else if (isRunpodProxyBaseUrl(baseUrl)) {\n      const pr = await runpodProxyReady(baseUrl, env);\n      if (!pr || !pr.ok) {\n        return { model, ok: false, status: 503, error: `warming (proxy_ready=${pr ? pr.status : 'no_response'})`, gov_pre, elapsed_ms: Date.now() - started };\n      }\n    }\n  }\n\n  const timeout_ms = parseIntEnv(env, 'BAKEOFF_TIMEOUT_MS') ?? 120000;\n  const payload = { model: upstreamModel, messages, max_tokens, stream: false, ...pass };\n\n  const headers = { 'Content-Type': 'application/json' };\n  if (providerName === 'runpod') {\n    headers.Authorization = 'Bearer ' + env.RUNPOD_API_KEY;\n  } else if (providerName === 'vastai') {\n    const key = (env.VASTAI_API_KEY || env.VLLM_API_KEY || '').trim();\n    if (key) headers.Authorization = 'Bearer ' + key;\n  } else {\n    return { model, ok: false, status: 500, error: `Unsupported provider: ${providerName}`, gov_pre, elapsed_ms: Date.now() - started };\n  }\n\n  try {\n    const res = await fetchWithTimeout(baseUrl + '/chat/completions', {\n      method: 'POST',\n      headers,\n      body: JSON.stringify(payload),\n    }, timeout_ms);\n    const text = await res.text();\n    if (!res.ok) {\n      const up = providerName === 'runpod' ? 'Runpod' : 'VastAI';\n      return { model, ok: false, status: 502, error: `${up} ${res.status}: ${clampString(redactSecrets(text), 600)}`, gov_pre, elapsed_ms: Date.now() - started };\n    }\n    const data = JSON.parse(text);\n    const content = data && data.choices && data.choices[0] && data.choices[0].message ? data.choices[0].message.content : '';\n    return {\n      model,\n      ok: true,\n      status: 200,\n      content: typeof content === 'string' ? content : '',\n      usage: data && data.usage ? data.usage : null,\n      gov_pre,\n      gov_post: { ok: true, elapsed_ms: Date.now() - started, trace_id },\n      elapsed_ms: Date.now() - started,\n    };\n  } catch (e) {\n    const up = providerName === 'runpod' ? 'Runpod' : 'VastAI';\n    return { model, ok: false, status: 502, error: `${up} error: ${clampString(String(e && e.message ? e.message : e), 180)}`, gov_pre, elapsed_ms: Date.now() - started };\n  }\n}\n\nfunction parseModelCsv(raw) {\n  const s = String(raw || '').trim();\n  if (!s) return [];\n  return s.split(',').map(v => v.trim()).filter(Boolean);\n}\n\nasync function oaiBakeoff(request, env) {\n  const gateErr = checkGatewayKey(request, env);\n  if (gateErr) return oaiError(401, gateErr, 'authentication_error');\n\n  let body;\n  try { body = await request.json(); }\n  catch { return oaiError(400, 'Invalid JSON'); }\n\n  const reg = listGatewayModels(env);\n  const models = Array.isArray(body.models) ? body.models.map(String).map(s => s.trim()).filter(Boolean) : [];\n  const audience = String(body.audience || body.suite || '').toLowerCase().trim();\n  const presetModels =\n    audience === 'dev' ? parseModelCsv(env.BAKEOFF_DEV_MODELS)\n      : audience === 'user' ? parseModelCsv(env.BAKEOFF_USER_MODELS)\n        : audience === 'experiment' ? parseModelCsv(env.BAKEOFF_EXPERIMENT_MODELS)\n        : [];\n  const defaults = (() => {\n    const chat = reg.find(m => m.id === 'canonic-chat') || reg.find(m => m.profile === 'chat') || reg[0];\n    const kilo = reg.find(m => m.id === 'canonic-kilocode') || reg.find(m => m.profile === 'kilocode');\n    const list = [];\n    if (chat && chat.id) list.push(chat.id);\n    if (kilo && kilo.id) list.push(kilo.id);\n    return list;\n  })();\n  const selected = models.length ? models : (presetModels.length ? presetModels : defaults);\n  const want = selected.map(String).map(s => s.trim()).filter(Boolean);\n  const entries = want.map(id => reg.find(m => m.id === id) || null).filter(Boolean);\n  if (!entries.length) return oaiError(400, 'No valid models requested');\n\n  const trace_id = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());\n\n  // Execute in parallel by default to make comparisons fast.\n  const parallel = body.parallel !== false;\n  const calls = entries.map(e => callGatewayModel(e, body, env, trace_id));\n  const results = parallel ? await Promise.all(calls) : (async () => { const out=[]; for (const c of calls) out.push(await c); return out; })();\n\n  return json({\n    object: 'bakeoff',\n    trace_id,\n    results,\n  });\n}\n\nasync function chat(request, env) {\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { message, history = [], system, scope } = body;\n  if (!message) return json({ error: 'Missing message' }, 400);\n\n  const messages = [];\n  for (const msg of history.slice(-10)) {\n    if (msg.role && msg.content) messages.push({ role: msg.role, content: msg.content });\n  }\n  if (!messages.length || messages[messages.length - 1].content !== message) {\n    messages.push({ role: 'user', content: message });\n  }\n\n  const systemPrompt = system || `TALK. Scope: ${scope || 'UNGOVERNED'}.`;\n\n  const trace_id = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());\n\n  const primary = env.PROVIDER;\n  const fallback = env.FALLBACK_PROVIDER || 'anthropic';\n  const chain = env.PROVIDER_CHAIN\n    ? String(env.PROVIDER_CHAIN).split(',').map(s => s.trim()).filter(Boolean)\n    : (primary === 'runpod' ? [primary, fallback] : [primary]);\n\n  const attempts = [];\n  const startedAt = Date.now();\n  for (let i = 0; i < chain.length; i++) {\n    const name = chain[i];\n    const provider = PROVIDERS[name];\n    if (!provider) {\n      attempts.push({ provider: name, ok: false, error: `Unknown provider: ${name}` });\n      continue;\n    }\n\n    const providerError = provider.validate?.(env);\n    if (providerError) {\n      attempts.push({ provider: name, ok: false, error: providerError });\n      continue;\n    }\n\n    const { headers, body: reqBody } = provider.build(env, systemPrompt, messages);\n    const providerUrl = typeof provider.url === 'function' ? provider.url(env) : provider.url;\n    const ms = timeoutMsFor(name, env);\n\n    let res;\n    const attemptStart = Date.now();\n    const gov_pre = {\n      provider: name,\n      url: providerUrl,\n      timeout_ms: ms,\n      model: reqBody && reqBody.model ? reqBody.model : null,\n      max_tokens: reqBody && reqBody.max_tokens ? reqBody.max_tokens : null,\n      messages: Array.isArray(reqBody && reqBody.messages) ? reqBody.messages.length : null,\n      tokens_min: parseIntEnv(env, 'TOKENS_MIN') ?? 16,\n      tokens_max: parseIntEnv(env, 'TOKENS_MAX') ?? 4096,\n      provider_tokens_max: parseIntEnv(env, `${String(name || '').toUpperCase()}_TOKENS_MAX`),\n    };\n    try {\n      // Governed retry policy: allow a small number of tries for Runpod cold starts.\n      const maxTries =\n        (name === 'runpod') ? (parseIntEnv(env, 'RUNPOD_TRIES') ?? 2)\n        : (name === 'vastai') ? (parseIntEnv(env, 'VASTAI_TRIES') ?? 1)\n        : 1;\n      const retryDelayMs =\n        (name === 'runpod') ? (parseIntEnv(env, 'RUNPOD_RETRY_DELAY_MS') ?? 750)\n        : (name === 'vastai') ? (parseIntEnv(env, 'VASTAI_RETRY_DELAY_MS') ?? 0)\n        : 0;\n      let lastErr = null;\n      for (let t = 0; t < maxTries; t++) {\n        try {\n          res = await fetchWithTimeout(providerUrl, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(reqBody),\n          }, ms);\n          lastErr = null;\n          break;\n        } catch (e) {\n          lastErr = e;\n          if (t + 1 < maxTries && retryDelayMs > 0) await new Promise(r => setTimeout(r, retryDelayMs));\n        }\n      }\n      if (lastErr) throw lastErr;\n    } catch (e) {\n      attempts.push({\n        provider: name,\n        ok: false,\n        elapsed_ms: Date.now() - attemptStart,\n        error: clampString(redactSecrets(String(e && e.message ? e.message : e)), 220),\n        gov_pre,\n      });\n      continue;\n    }\n\n    if (!res || !res.ok) {\n      const status = res ? res.status : 0;\n      const errBody = res ? await res.text() : '';\n      const safeErr = redactSecrets(errBody);\n      attempts.push({\n        provider: name,\n        ok: false,\n        elapsed_ms: Date.now() - attemptStart,\n        status,\n        detail: clampString(safeErr, 600),\n        gov_pre,\n        gov_post: {\n          ok: false,\n          status,\n          elapsed_ms: Date.now() - attemptStart,\n        },\n      });\n\n      // Fallback only on likely-provider/system issues.\n      const shouldFallback = (status >= 500 || status === 429 || status === 0);\n      if (shouldFallback) continue;\n      return json(\n        { error: `${name} ${status}`, detail: clampString(safeErr, 600), scope, trace_id },\n        502,\n      );\n    }\n\n    const data = await res.json();\n    const parsed = provider.parse(data) || '';\n    attempts.push({\n      provider: name,\n      ok: true,\n      elapsed_ms: Date.now() - attemptStart,\n      gov_pre,\n      gov_post: {\n        ok: true,\n        status: res.status,\n        elapsed_ms: Date.now() - attemptStart,\n        usage: data && data.usage ? data.usage : null,\n        parsed_chars: typeof parsed === 'string' ? parsed.length : 0,\n        schema_ok: typeof parsed === 'string' && parsed.length > 0,\n      },\n    });\n    // Structured trace (Cloudflare dashboard \u2014 GOV: TALK/CANON.md)\n    console.log(JSON.stringify({ ts: new Date().toISOString(), path: '/chat', provider: name, status: 200, latency_ms: Date.now() - startedAt, scope, trace_id }));\n    return json({\n      message: parsed || 'No response.',\n      scope,\n      provider_requested: primary,\n      provider_used: name,\n      provider_chain: chain,\n      attempts,\n      usage: data && data.usage ? data.usage : null,\n      elapsed_ms: Date.now() - startedAt,\n      trace_id,\n    });\n  }\n\n  console.log(JSON.stringify({ ts: new Date().toISOString(), path: '/chat', provider: 'NONE', status: 502, latency_ms: Date.now() - startedAt, scope, trace_id, chain }));\n  return json(\n    {\n      error: 'All providers failed',\n      scope,\n      provider_chain: chain,\n      attempts,\n      elapsed_ms: Date.now() - startedAt,\n      trace_id,\n    },\n    502,\n  );\n}\n\n// \u2500\u2500 SHOP \u2014 Stripe checkout + wallet summary \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function shopCheckout(request, env) {\n  if (!env.STRIPE_SECRET_KEY) return json({ error: 'STRIPE_SECRET_KEY not configured' }, 500);\n\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const eventType = normalizeShopEvent(body && body.event) || '';\n  if (!eventType || !['SALE', 'DONATION', 'INVEST'].includes(eventType)) {\n    return json({ error: 'event must be SALE, DONATION, or INVEST' }, 400);\n  }\n\n  const amountCoin = parseInt(body && body.amount_coin, 10);\n  if (!Number.isFinite(amountCoin) || amountCoin < 1 || amountCoin > 1000000) {\n    return json({ error: 'amount_coin must be an integer between 1 and 1000000' }, 400);\n  }\n\n  const product = normalizeShopProduct(body && body.product);\n  const service = normalizeShopProduct((body && body.service) || 'BOOK');\n  const channel = normalizeShopProduct((body && body.channel) || 'SHOP');\n  const note = clampString(String((body && body.note) || ''), 500);\n  const name = clampString(String((body && body.name) || ''), 120);\n  const email = clampString(String((body && body.email) || ''), 240);\n  const coinToCents = Math.max(1, intEnv(env, 'SHOP_COIN_USD_CENTS', 100));\n  const currency = String(env.SHOP_CURRENCY || 'usd').toLowerCase();\n  const unitAmount = amountCoin * coinToCents;\n  const origin = String(env.SHOP_ORIGIN || 'https://hadleylab-dexter.github.io').replace(/\\/+$/, '');\n  const successDefault = `${origin}/BOOKS/?checkout=success&session_id={CHECKOUT_SESSION_ID}`;\n  const cancelDefault = `${origin}/BOOKS/?checkout=cancel`;\n  const successUrl = String((body && body.success_url) || env.SHOP_SUCCESS_URL || successDefault).trim();\n  const cancelUrl = String((body && body.cancel_url) || env.SHOP_CANCEL_URL || cancelDefault).trim();\n\n  if (!/^https?:\\/\\//i.test(successUrl) || !/^https?:\\/\\//i.test(cancelUrl)) {\n    return json({ error: 'success_url and cancel_url must be absolute HTTP URLs' }, 400);\n  }\n\n  const titleByType = {\n    SALE: `${product} Reserve`,\n    DONATION: `${product} Donation`,\n    INVEST: `${product} Investor Commitment`,\n  };\n\n  const fields = {\n    mode: 'payment',\n    success_url: successUrl,\n    cancel_url: cancelUrl,\n    'line_items[0][quantity]': '1',\n    'line_items[0][price_data][currency]': currency,\n    'line_items[0][price_data][unit_amount]': String(unitAmount),\n    'line_items[0][price_data][product_data][name]': titleByType[eventType] || `${product} ${eventType}`,\n    'metadata[event]': eventType,\n    'metadata[type]': eventType,\n    'metadata[service]': service,\n    'metadata[product]': product,\n    'metadata[channel]': channel,\n    'metadata[amount_coin]': String(amountCoin),\n    'metadata[note]': note,\n    'metadata[name]': name,\n    'metadata[email]': email,\n    'payment_intent_data[metadata][event]': eventType,\n    'payment_intent_data[metadata][service]': service,\n    'payment_intent_data[metadata][product]': product,\n    'payment_intent_data[metadata][channel]': channel,\n    'payment_intent_data[metadata][amount_coin]': String(amountCoin),\n  };\n  if (email) fields.customer_email = email;\n\n  const created = await stripeApiRequest(env, 'POST', '/v1/checkout/sessions', fields);\n  if (!created.ok) return json({ error: created.error || 'Stripe checkout create failed' }, created.status || 502);\n\n  const session = created.data || {};\n  return json({\n    ok: true,\n    session_id: session.id,\n    url: session.url,\n    event: eventType,\n    product,\n    amount_coin: amountCoin,\n    amount_minor: unitAmount,\n    currency,\n  });\n}\n\nasync function shopStripeWebhook(request, env) {\n  if (!env.STRIPE_WEBHOOK_SECRET) return json({ error: 'STRIPE_WEBHOOK_SECRET not configured' }, 500);\n  const raw = await request.text();\n  const sig = request.headers.get('stripe-signature') || '';\n  const toleranceSec = Math.max(10, intEnv(env, 'SHOP_WEBHOOK_TOLERANCE_SEC', 300));\n  const verified = await stripeVerifyWebhookSignature(raw, sig, env.STRIPE_WEBHOOK_SECRET, toleranceSec);\n  if (!verified.ok) return json({ error: verified.error || 'Invalid Stripe signature' }, 401);\n\n  let evt;\n  try { evt = JSON.parse(raw); }\n  catch { return json({ error: 'Invalid Stripe event JSON' }, 400); }\n\n  const typ = String(evt && evt.type || '');\n  const obj = evt && evt.data && evt.data.object ? evt.data.object : {};\n  const coinToCents = Math.max(1, intEnv(env, 'SHOP_COIN_USD_CENTS', 100));\n  const mapped = walletEventFromStripeSession(obj, coinToCents);\n\n  // Optional outbound fanout for filesystem VAULT ingest bridge.\n  const relay = String(env.SHOP_STRIPE_EVENT_WEBHOOK_URL || '').trim();\n  let relayed = false;\n  if (relay && /^https?:\\/\\//i.test(relay)) {\n    try {\n      const relayPayload = {\n        source: 'stripe',\n        stripe_event_id: evt && evt.id ? evt.id : '',\n        stripe_type: typ,\n        wallet_event: mapped,\n        raw: {\n          id: obj && obj.id ? obj.id : '',\n          status: obj && obj.status ? obj.status : '',\n          payment_status: obj && obj.payment_status ? obj.payment_status : '',\n        },\n      };\n      await fetch(relay, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(relayPayload),\n      });\n      relayed = true;\n    } catch {\n      relayed = false;\n    }\n  }\n\n  // LEDGER: every Stripe event is INTEL (GOV: LEDGER/CANON.md)\n  const ledgerResult = await appendToLedger(env, 'SHOP', 'SHOP', {\n    stripe_event_id: evt && evt.id ? evt.id : '',\n    stripe_type: typ,\n    session_id: obj && obj.id ? obj.id : '',\n    status: obj && obj.status ? obj.status : '',\n    payment_status: obj && obj.payment_status ? obj.payment_status : '',\n    wallet_event: mapped,\n    work_ref: evt && evt.id ? evt.id : '',\n  });\n\n  return json({\n    ok: true,\n    stripe_event_id: evt && evt.id ? evt.id : '',\n    stripe_type: typ,\n    wallet_event: mapped,\n    relayed,\n    ledger: ledgerResult,\n  });\n}\n\nasync function shopWallet(request, env) {\n  if (!env.STRIPE_SECRET_KEY) {\n    if (boolEnv(env, 'SHOP_WALLET_STRIPE_REQUIRED', true)) {\n      return json({ error: 'STRIPE_SECRET_KEY not configured' }, 500);\n    }\n    return json({ wallet: initWalletSummary(), source: 'empty' });\n  }\n\n  const url = new URL(request.url);\n  const top = Math.max(1, Math.min(100, parseInt(url.searchParams.get('top') || '12', 10) || 12));\n  const perPage = Math.max(1, Math.min(100, parseInt(url.searchParams.get('limit') || String(intEnv(env, 'SHOP_WALLET_PAGE_LIMIT', 100)), 10) || 100));\n  const maxPages = Math.max(1, Math.min(20, parseInt(url.searchParams.get('pages') || String(intEnv(env, 'SHOP_WALLET_MAX_PAGES', 3)), 10) || 3));\n  const coinToCents = Math.max(1, intEnv(env, 'SHOP_COIN_USD_CENTS', 100));\n\n  const wallet = initWalletSummary();\n  let startingAfter = '';\n  let fetched = 0;\n\n  for (let page = 0; page < maxPages; page++) {\n    const qs = new URLSearchParams();\n    qs.set('limit', String(perPage));\n    if (startingAfter) qs.set('starting_after', startingAfter);\n    const listed = await stripeApiRequest(env, 'GET', `/v1/checkout/sessions?${qs.toString()}`);\n    if (!listed.ok) return json({ error: listed.error || 'Stripe list sessions failed' }, listed.status || 502);\n\n    const data = listed.data || {};\n    const rows = Array.isArray(data.data) ? data.data : [];\n    fetched += rows.length;\n    if (!rows.length) break;\n\n    for (const session of rows) {\n      const evt = walletEventFromStripeSession(session, coinToCents);\n      if (!evt) continue;\n      wallet.events += 1;\n      wallet.balance += evt.delta;\n      if (wallet.totals[evt.type] !== undefined) wallet.totals[evt.type] += evt.amount;\n      if (evt.delta >= 0) wallet.totals.credit += evt.delta;\n      else wallet.totals.debit += Math.abs(evt.delta);\n      wallet.totals.net = wallet.totals.credit - wallet.totals.debit;\n      applyWalletDelta(wallet.services, evt.service, evt.delta);\n      applyWalletDelta(wallet.products, evt.product, evt.delta);\n      wallet.recent.push({\n        id: evt.id,\n        ts: evt.ts,\n        type: evt.type,\n        service: evt.service,\n        product: evt.product,\n        amount: evt.amount,\n        delta: evt.delta,\n      });\n    }\n\n    if (!data.has_more) break;\n    startingAfter = rows[rows.length - 1] && rows[rows.length - 1].id ? rows[rows.length - 1].id : '';\n    if (!startingAfter) break;\n  }\n\n  wallet.services = sortedWalletBucket(wallet.services, top);\n  wallet.products = sortedWalletBucket(wallet.products, top);\n  wallet.recent = wallet.recent.sort((a, b) => String(b.ts).localeCompare(String(a.ts))).slice(0, top);\n  wallet.updated_at = new Date().toISOString();\n\n  return json({\n    wallet,\n    source: 'stripe',\n    fetched_sessions: fetched,\n    coin_to_cents: coinToCents,\n  });\n}\n\n// \u2500\u2500 AUTH \u2014 GitHub OAuth KYC \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction authConfig(env) {\n  if (!env.GITHUB_CLIENT_ID) {\n    return json({ error: 'GITHUB_CLIENT_ID not configured' }, 500);\n  }\n  return json({\n    github_client_id: env.GITHUB_CLIENT_ID,\n    scopes: 'read:user',\n  });\n}\n\nasync function authGitHub(request, env) {\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { code, redirect_uri } = body;\n  if (!code) return json({ error: 'Missing code' }, 400);\n\n  if (!env.GITHUB_CLIENT_ID || !env.GITHUB_CLIENT_SECRET) {\n    return json({ error: 'GitHub OAuth not configured' }, 500);\n  }\n\n  // Exchange code for access token (retry with backoff \u2014 GOV: API/CANON.md)\n  const tokenRes = await fetchWithRetry('https://github.com/login/oauth/access_token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n    },\n    body: JSON.stringify({\n      client_id: env.GITHUB_CLIENT_ID,\n      client_secret: env.GITHUB_CLIENT_SECRET,\n      code,\n      redirect_uri,\n    }),\n  }, { maxRetries: 2, timeoutMs: 10000 });\n\n  const tokenData = await tokenRes.json();\n  if (tokenData.error) {\n    return json({ error: tokenData.error_description || tokenData.error }, 401);\n  }\n\n  // Fetch user profile (retry with backoff \u2014 GOV: API/CANON.md)\n  const userRes = await fetchWithRetry('https://api.github.com/user', {\n    headers: {\n      'Authorization': `Bearer ${tokenData.access_token}`,\n      'User-Agent': 'CANONIC-KYC',\n      'Accept': 'application/json',\n    },\n  }, { maxRetries: 2, timeoutMs: 10000 });\n\n  if (!userRes.ok) {\n    return json({ error: 'Failed to fetch GitHub user' }, 502);\n  }\n\n  const user = await userRes.json();\n\n  // Create server-side session in TALK_KV\n  const sessionToken = crypto.randomUUID();\n  const session = {\n    user: user.login,\n    github_uid: user.id,\n    name: user.name,\n    avatar_url: user.avatar_url,\n    org: 'hadleylab',\n    ts: new Date().toISOString(),\n    expires: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days\n  };\n\n  if (env.TALK_KV) {\n    await env.TALK_KV.put(`session:${sessionToken}`, JSON.stringify(session), {\n      expirationTtl: 7 * 24 * 60 * 60, // 7 days in seconds\n    });\n\n    // LEDGER: auth login is INTEL (GOV: LEDGER/CANON.md)\n    await appendToLedger(env, 'AUTH', 'AUTH', {\n      event: 'login',\n      user: user.login,\n      github_uid: user.id,\n      provider: 'github',\n      work_ref: `login:${user.login}`,\n    });\n  }\n\n  return json({\n    session_token: sessionToken,\n    user: user.login,\n    name: user.name,\n    avatar_url: user.avatar_url,\n    provenance: {\n      provider: 'github',\n      uid: user.id,\n      verified_at: session.ts,\n      gate: 'MAGIC-KYC',\n    },\n  });\n}\n\nasync function authSession(request, env) {\n  const token = extractSessionToken(request);\n  if (!token) return json({ error: 'Missing session token' }, 401);\n\n  if (!env.TALK_KV) return json({ error: 'KV not configured' }, 500);\n\n  const raw = await env.TALK_KV.get(`session:${token}`);\n  if (!raw) return json({ error: 'Invalid or expired session' }, 401);\n\n  const session = JSON.parse(raw);\n  if (new Date(session.expires) < new Date()) {\n    await env.TALK_KV.delete(`session:${token}`);\n    return json({ error: 'Session expired' }, 401);\n  }\n\n  return json({\n    user: session.user,\n    github_uid: session.github_uid,\n    name: session.name,\n    avatar_url: session.avatar_url,\n    org: session.org,\n    ts: session.ts,\n    expires: session.expires,\n  });\n}\n\nasync function authLogout(request, env) {\n  const token = extractSessionToken(request);\n  if (!token) return json({ error: 'Missing session token' }, 401);\n\n  if (env.TALK_KV) {\n    const raw = await env.TALK_KV.get(`session:${token}`);\n    if (raw) {\n      const session = JSON.parse(raw);\n      await env.TALK_KV.delete(`session:${token}`);\n      // LEDGER: auth logout is INTEL (GOV: LEDGER/CANON.md)\n      await appendToLedger(env, 'AUTH', 'AUTH', {\n        event: 'logout',\n        user: session.user,\n        work_ref: `logout:${session.user}`,\n      });\n    }\n  }\n\n  return json({ ok: true });\n}\n\nasync function authGrants(request, env) {\n  const url = new URL(request.url);\n  const scope = url.searchParams.get('scope');\n  if (!scope) return json({ error: 'Missing scope parameter' }, 400);\n\n  const token = extractSessionToken(request);\n  if (!token) return json({ granted: false, reason: 'no_session' });\n\n  if (!env.TALK_KV) return json({ error: 'KV not configured' }, 500);\n\n  const raw = await env.TALK_KV.get(`session:${token}`);\n  if (!raw) return json({ granted: false, reason: 'invalid_session' });\n\n  const session = JSON.parse(raw);\n  if (new Date(session.expires) < new Date()) {\n    return json({ granted: false, reason: 'expired_session' });\n  }\n\n  // Fetch scope's CANON.json to check privacy/readers\n  // Convention: CANON.json is stored at canon:{scope} in KV or fetched from origin\n  const canonKey = `canon:${scope}`;\n  const canonRaw = await env.TALK_KV.get(canonKey);\n\n  if (!canonRaw) {\n    // No CANON.json cached \u2014 default: grant if authenticated (ORG member)\n    return json({ granted: true, user: session.user, reason: 'org_member_default' });\n  }\n\n  const canon = JSON.parse(canonRaw);\n  if (!canon.privacy || canon.privacy === 'PUBLIC') {\n    return json({ granted: true, user: session.user, reason: 'public_scope' });\n  }\n\n  // PRIVATE scope \u2014 check readers\n  const readers = canon.readers || [];\n  if (readers.length === 0) {\n    // No readers declared \u2014 ORG members only (fail-closed to public, open to org)\n    return json({ granted: true, user: session.user, reason: 'org_member' });\n  }\n\n  if (readers.includes('*') || readers.includes(session.user)) {\n    return json({ granted: true, user: session.user, reason: 'reader' });\n  }\n\n  // Ledger deny\n  if (env.TALK_KV) {\n    await env.TALK_KV.put(\n      `auth:deny:${session.user}:${scope}:${Date.now()}`,\n      JSON.stringify({ user: session.user, scope, ts: new Date().toISOString() }),\n      { expirationTtl: 30 * 24 * 60 * 60 }\n    );\n  }\n\n  return json({ granted: false, user: session.user, reason: 'not_reader' });\n}\n\nfunction extractSessionToken(request) {\n  const authHeader = request.headers.get('Authorization');\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    return authHeader.slice(7).trim();\n  }\n  // Also check query param for GET requests\n  const url = new URL(request.url);\n  return url.searchParams.get('token') || null;\n}\n\n// \u2500\u2500 EMAIL \u2014 Branded HTML via Resend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function emailSend(request, env) {\n  if (!env.RESEND_API_KEY) {\n    return json({ error: 'RESEND_API_KEY not configured' }, 500);\n  }\n\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { to, subject, html, from, cc, bcc, reply_to } = body;\n  if (!to || !subject || !html) {\n    return json({ error: 'Missing to, subject, or html' }, 400);\n  }\n\n  const sender = from || env.EMAIL_FROM || 'founder@canonic.org';\n  const recipient = Array.isArray(to) ? to[0] : to;\n\n  const payload = { from: sender, to: [recipient], subject, html };\n  if (cc) payload.cc = Array.isArray(cc) ? cc : [cc];\n\n  // GOV: EMAIL/CANON.md \u2014 MUST BCC sender on every outbound. Auto-inject if absent.\n  const senderAddr = sender.includes('<') ? sender.match(/<([^>]+)>/)?.[1] || sender : sender;\n  if (bcc) {\n    const bccList = Array.isArray(bcc) ? bcc : [bcc];\n    if (!bccList.includes(senderAddr)) bccList.push(senderAddr);\n    payload.bcc = bccList;\n  } else {\n    payload.bcc = [senderAddr];\n  }\n\n  if (reply_to) payload.reply_to = reply_to;\n  if (body.attachments) payload.attachments = body.attachments;\n\n  const res = await fetchWithRetry('https://api.resend.com/emails', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${env.RESEND_API_KEY}`,\n    },\n    body: JSON.stringify(payload),\n  }, { maxRetries: 2, timeoutMs: 10000 });\n\n  if (!res.ok) {\n    const errBody = await res.text();\n    return json({ error: `Resend ${res.status}`, detail: errBody }, 502);\n  }\n\n  const data = await res.json();\n\n  // LEDGER: every email send is INTEL (GOV: LEDGER/CANON.md)\n  const ledgerResult = await appendToLedger(env, 'EMAIL', body.scope || 'EMAIL', {\n    to: recipient,\n    cc: payload.cc || null,\n    bcc: payload.bcc || null,\n    subject,\n    from: sender,\n    work_ref: data.id, // resend_id\n  });\n\n  return json({ sent: true, id: data.id, to: recipient, subject, ledger: ledgerResult });\n}\n\n// \u2500\u2500 HASH \u2014 Content addressing for ledger chain integrity \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function sha256(message) {\n  const data = new TextEncoder().encode(message);\n  const hash = await crypto.subtle.digest('SHA-256', data);\n  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n// \u2500\u2500 SANITIZE \u2014 Strip HTML tags from user input \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction sanitize(str) {\n  if (!str || typeof str !== 'string') return str;\n  return str.replace(/<[^>]*>/g, '').trim();\n}\n\n// \u2500\u2500 RATE LIMIT \u2014 KV-backed per-key rate limiting \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function checkRate(env, prefix, key, maxPerHour) {\n  if (!env.TALK_KV) return false;\n  const rateKey = `rate:${prefix}:${key}`;\n  const count = parseInt(await env.TALK_KV.get(rateKey) || '0', 10);\n  if (count >= maxPerHour) return true; // rate limited\n  await env.TALK_KV.put(rateKey, String(count + 1), { expirationTtl: 3600 });\n  return false;\n}\n\n// \u2500\u2500 LEDGER APPEND \u2014 Unified hash-chained append for all stream types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// GOV: LEDGER/CANON.md \u2014 every record gets id + prev + type + scope\n// Types: GRADIENT | TALK | CONTRIBUTE | EMAIL | PROVISION | AUTH | SHOP\n\nasync function appendToLedger(env, type, scope, fields) {\n  if (!env.TALK_KV) return null;\n  const key = `ledger:${type}:${scope}`;\n  let ledger = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) ledger = JSON.parse(raw);\n  } catch {}\n\n  const ts = new Date().toISOString();\n  const prev = ledger.length ? ledger[ledger.length - 1].id : '000000000000';\n  const id = await sha256(`${ts}:${type}:${scope}:${prev}:${JSON.stringify(fields)}`);\n\n  const entry = { id, prev, ts, type, scope, ...fields };\n  ledger.push(entry);\n\n  if (ledger.length > 1000) {\n    const epoch = Math.floor(Date.now() / 1000);\n    const overflow = ledger.slice(0, ledger.length - 1000);\n    await env.TALK_KV.put(`${key}:archive:${epoch}`, JSON.stringify(overflow));\n    ledger = ledger.slice(-1000);\n  }\n\n  await env.TALK_KV.put(key, JSON.stringify(ledger));\n  return { id, ts, entries: ledger.length };\n}\n\n// \u2500\u2500 TALK LEDGER \u2014 Server-side session logging \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function talkLedgerWrite(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  // Rate limit: 100 ledger writes per scope per hour\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { scope, trace_id, provider_used, elapsed_ms } = body;\n  const user_message = sanitize(body.user_message);\n  const assistant_message = sanitize(body.assistant_message);\n  if (!scope || !user_message) return json({ error: 'Missing scope or user_message' }, 400);\n\n  if (await checkRate(env, 'ledger', scope, 100)) {\n    return json({ error: 'Rate limited', scope }, 429);\n  }\n\n  const ts = new Date().toISOString();\n\n  // Append to scope's ledger (list stored as JSON array in KV)\n  const key = `ledger:${scope}`;\n  let ledger = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) ledger = JSON.parse(raw);\n  } catch {}\n\n  // Hash chain: id = content hash, prev = last entry's id\n  const prev = ledger.length ? ledger[ledger.length - 1].id : '000000000000';\n  const id = await sha256(`${ts}:${scope}:${user_message}:${prev}`);\n\n  const entry = {\n    id,\n    prev,\n    ts,\n    type: 'TALK',\n    scope,\n    trace_id: trace_id || null,\n    user: user_message,\n    assistant: assistant_message || null,\n    provider: provider_used || null,\n    elapsed_ms: elapsed_ms || null,\n  };\n\n  ledger.push(entry);\n  // Cap at 1000 entries per scope \u2014 archive overflow before pruning\n  if (ledger.length > 1000) {\n    const epoch = Math.floor(Date.now() / 1000);\n    const overflow = ledger.slice(0, ledger.length - 1000);\n    await env.TALK_KV.put(`${key}:archive:${epoch}`, JSON.stringify(overflow));\n    ledger = ledger.slice(-1000);\n  }\n\n  await env.TALK_KV.put(key, JSON.stringify(ledger));\n\n  // NOTIFY: direct mapping \u2014 scope \u2192 targets, inline at write time (no polling)\n  // notify[] comes from CANON.json via talk.js \u2014 GOV tree is source of truth\n  const notify = Array.isArray(body.notify) ? body.notify : [];\n  for (const target of notify) {\n    if (!target || typeof target !== 'string') continue;\n    const inboxKey = `inbox:${target}`;\n    let inbox = [];\n    try {\n      const raw = await env.TALK_KV.get(inboxKey);\n      if (raw) inbox = JSON.parse(raw);\n    } catch {}\n    inbox.push({\n      id,\n      ts,\n      from: scope,\n      to: target,\n      message: user_message,\n      context: assistant_message || null,\n      read: false,\n    });\n    if (inbox.length > 500) inbox = inbox.slice(-500);\n    await env.TALK_KV.put(inboxKey, JSON.stringify(inbox));\n  }\n\n  return json({ ok: true, id, scope, entries: ledger.length, ts, notified: notify });\n}\n\nasync function talkLedgerRead(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  const url = new URL(request.url);\n  const scope = url.searchParams.get('scope');\n  if (!scope) return json({ error: 'Missing scope param' }, 400);\n\n  const key = `ledger:${scope}`;\n  let ledger = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) ledger = JSON.parse(raw);\n  } catch {}\n\n  const limit = Math.min(parseInt(url.searchParams.get('limit') || '50', 10), 200);\n  const offset = parseInt(url.searchParams.get('offset') || '0', 10);\n  const slice = ledger.slice(-(offset + limit), offset ? -offset : undefined);\n\n  return json({ scope, total: ledger.length, entries: slice });\n}\n\n// \u2500\u2500 TALK MESSAGING \u2014 Cross-user communication \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function talkSend(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { from, to, message, context } = body;\n  if (!from || !to || !message) return json({ error: 'Missing from, to, or message' }, 400);\n\n  const ts = new Date().toISOString();\n  const id = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());\n  const entry = { id, ts, from, to, message, context: context || null, read: false };\n\n  // Append to recipient's inbox\n  const key = `inbox:${to}`;\n  let inbox = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) inbox = JSON.parse(raw);\n  } catch {}\n\n  inbox.push(entry);\n  if (inbox.length > 500) inbox = inbox.slice(-500);\n\n  await env.TALK_KV.put(key, JSON.stringify(inbox));\n\n  // Also log to sender's outbox for audit\n  const outKey = `outbox:${from}`;\n  let outbox = [];\n  try {\n    const raw = await env.TALK_KV.get(outKey);\n    if (raw) outbox = JSON.parse(raw);\n  } catch {}\n  outbox.push(entry);\n  if (outbox.length > 500) outbox = outbox.slice(-500);\n  await env.TALK_KV.put(outKey, JSON.stringify(outbox));\n\n  // LEDGER: every cross-user message is INTEL (GOV: LEDGER/CANON.md)\n  await appendToLedger(env, 'TALK', `MSG:${from}:${to}`, {\n    from,\n    to,\n    message_id: id,\n    work_ref: id,\n  });\n\n  return json({ ok: true, id, from, to, ts });\n}\n\nasync function talkInbox(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  const url = new URL(request.url);\n  const scope = url.searchParams.get('scope');\n  if (!scope) return json({ error: 'Missing scope param' }, 400);\n\n  const key = `inbox:${scope}`;\n  let inbox = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) inbox = JSON.parse(raw);\n  } catch {}\n\n  const unreadOnly = url.searchParams.get('unread') === 'true';\n  const messages = unreadOnly ? inbox.filter(m => !m.read) : inbox;\n\n  return json({ scope, total: inbox.length, unread: inbox.filter(m => !m.read).length, messages });\n}\n\nasync function talkAck(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { scope, message_ids } = body;\n  if (!scope || !Array.isArray(message_ids)) return json({ error: 'Missing scope or message_ids' }, 400);\n\n  const key = `inbox:${scope}`;\n  let inbox = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) inbox = JSON.parse(raw);\n  } catch {}\n\n  const idSet = new Set(message_ids);\n  let acked = 0;\n  for (const msg of inbox) {\n    if (idSet.has(msg.id) && !msg.read) {\n      msg.read = true;\n      acked++;\n    }\n  }\n\n  await env.TALK_KV.put(key, JSON.stringify(inbox));\n  return json({ ok: true, scope, acked });\n}\n\n// \u2500\u2500 CONTRIBUTE \u2014 Governed contribution ledger (COIN mint) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function contribute(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  let body;\n  try { body = await request.json(); }\n  catch { return json({ error: 'Invalid JSON' }, 400); }\n\n  const { scope, contributor, email, affiliation, chapter, source } = body;\n  const story = sanitize(body.story);\n  if (!scope || !story) return json({ error: 'Missing scope or story' }, 400);\n\n  // Rate limit: 10 contributions per IP per hour\n  const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\n  if (await checkRate(env, 'contribute', ip, 10)) {\n    return json({ error: 'Rate limited' }, 429);\n  }\n\n  const ts = new Date().toISOString();\n\n  const key = `contributions:${scope}`;\n  let ledger = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) ledger = JSON.parse(raw);\n  } catch {}\n\n  // Hash chain: id = content hash, prev = last entry's id\n  const prev = ledger.length ? ledger[ledger.length - 1].id : '000000000000';\n  const id = await sha256(`${ts}:${scope}:${story}:${prev}`);\n\n  const entry = {\n    id,\n    prev,\n    ts,\n    type: 'CONTRIBUTE',\n    scope,\n    contributor: contributor || 'Anonymous',\n    email: email || null,\n    affiliation: affiliation || null,\n    chapter: chapter || null,\n    story,\n    source: source || null,\n    coin_event: 'MINT:CONTRIBUTE',\n  };\n\n  ledger.push(entry);\n  // Cap at 1000 entries per scope \u2014 archive overflow before pruning\n  if (ledger.length > 1000) {\n    const epoch = Math.floor(Date.now() / 1000);\n    const overflow = ledger.slice(0, ledger.length - 1000);\n    await env.TALK_KV.put(`${key}:archive:${epoch}`, JSON.stringify(overflow));\n    ledger = ledger.slice(-1000);\n  }\n\n  await env.TALK_KV.put(key, JSON.stringify(ledger));\n\n  // Fire confirmation email (non-blocking \u2014 don't fail the contribution if email fails)\n  if (email && env.RESEND_API_KEY) {\n    try {\n      const name = contributor || 'Friend';\n      const receiptShort = id.slice(0, 8);\n      const storyPreview = story.length > 200 ? story.slice(0, 200) + '...' : story;\n      const emailHtml = `\n<div style=\"font-family:'Helvetica Neue',Arial,sans-serif;max-width:600px;margin:0 auto;background:#0a0a0a;color:#e5e5e5;padding:40px;border:1px solid #222;\">\n  <div style=\"text-align:center;margin-bottom:32px;\">\n    <div style=\"font-size:28px;font-weight:800;letter-spacing:2px;color:#d4a855;\">COIN MINTED</div>\n    <div style=\"font-size:13px;color:#888;margin-top:4px;\">${scope}</div>\n  </div>\n  <div style=\"margin-bottom:24px;\">\n    <span style=\"color:#d4a855;\">Dear ${name},</span>\n  </div>\n  <div style=\"margin-bottom:24px;line-height:1.6;\">\n    Your contribution has been recorded on the governed ledger. Every contribution is WORK. Every WORK mints COIN.\n  </div>\n  <div style=\"background:#111;border:1px solid #333;padding:20px;margin-bottom:24px;font-family:monospace;font-size:13px;\">\n    <div><span style=\"color:#888;\">Receipt:</span> <span style=\"color:#d4a855;\">${receiptShort}</span></div>\n    <div><span style=\"color:#888;\">Event:</span> MINT:CONTRIBUTE</div>\n    <div><span style=\"color:#888;\">Scope:</span> ${scope}</div>\n    <div><span style=\"color:#888;\">Time:</span> ${ts}</div>\n    ${chapter ? '<div><span style=\"color:#888;\">Chapter:</span> ' + chapter + '</div>' : ''}\n    ${source ? '<div><span style=\"color:#888;\">Source:</span> ' + source + '</div>' : ''}\n  </div>\n  <div style=\"margin-bottom:24px;line-height:1.6;\">\n    <span style=\"color:#888;\">Your words:</span><br>\n    <em>&ldquo;${storyPreview}&rdquo;</em>\n  </div>\n  <div style=\"text-align:center;margin:32px 0;\">\n    <a href=\"https://hadleylab-canonic.github.io/SHOP/\" style=\"background:#d4a855;color:#000;padding:12px 32px;text-decoration:none;font-weight:700;font-size:14px;letter-spacing:1px;\">CLAIM YOUR COIN</a>\n  </div>\n  <div style=\"margin-bottom:24px;line-height:1.6;font-size:14px;\">\n    Your COIN is waiting. Every contribution is work. Every work has value. Claim yours.\n  </div>\n  <div style=\"border-top:1px solid #222;padding-top:20px;font-size:12px;color:#666;text-align:center;\">\n    Every contribution governed. Every provenance traced.<br><br>\n    <a href=\"https://canonic.org\" style=\"color:#d4a855;text-decoration:none;\">CANONIC</a>\n  </div>\n</div>`;\n\n      await fetch('https://api.resend.com/emails', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${env.RESEND_API_KEY}`,\n        },\n        body: JSON.stringify({\n          from: 'CANONIC <canonic@canonic.org>',\n          to: [email],\n          subject: `COIN MINTED \u2014 Your ${scope} contribution (${receiptShort})`,\n          html: emailHtml,\n        }),\n      });\n    } catch (emailErr) {\n      // Email failure must not block the contribution response\n    }\n  }\n\n  return json({ ok: true, id, scope, ts, coin_event: 'MINT:CONTRIBUTE', entries: ledger.length });\n}\n\nasync function contributeRead(request, env) {\n  if (!env.TALK_KV) return json({ error: 'TALK_KV not configured' }, 500);\n\n  const url = new URL(request.url);\n  const scope = url.searchParams.get('scope');\n  if (!scope) return json({ error: 'Missing scope param' }, 400);\n\n  const key = `contributions:${scope}`;\n  let ledger = [];\n  try {\n    const raw = await env.TALK_KV.get(key);\n    if (raw) ledger = JSON.parse(raw);\n  } catch {}\n\n  const limit = Math.min(parseInt(url.searchParams.get('limit') || '50', 10), 200);\n  const offset = parseInt(url.searchParams.get('offset') || '0', 10);\n  const slice = ledger.slice(-(offset + limit), offset ? -offset : undefined);\n\n  return json({ scope, total: ledger.length, entries: slice });\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\n// A middleware has to be a function of type Middleware\nconst scheduled: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\tconst url = new URL(request.url);\n\tif (url.pathname === \"/__scheduled\") {\n\t\tconst cron = url.searchParams.get(\"cron\") ?? \"\";\n\t\tawait middlewareCtx.dispatch(\"scheduled\", { cron });\n\n\t\treturn new Response(\"Ran scheduled event\");\n\t}\n\n\tconst resp = await middlewareCtx.next(request, env);\n\n\t// If you open the `/__scheduled` page in a browser, the browser will automatically make a request to `/favicon.ico`.\n\t// For scheduled Workers _without_ a fetch handler, this will result in a 500 response that clutters the log with unhelpful error messages.\n\t// To avoid this, inject a 404 response to favicon.ico loads on the `/__scheduled` page\n\tif (\n\t\trequest.headers.get(\"referer\")?.endsWith(\"/__scheduled\") &&\n\t\turl.pathname === \"/favicon.ico\" &&\n\t\tresp.status === 500\n\t) {\n\t\treturn new Response(null, { status: 404 });\n\t}\n\n\treturn resp;\n};\n\nexport default scheduled;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/iDrDex/.canonic/design/TALK/src/worker.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-scheduled.ts\";\nimport * as __MIDDLEWARE_2__ from \"/opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/iDrDex/.canonic/design/TALK/src/worker.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default,__MIDDLEWARE_2__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/iDrDex/.canonic/design/TALK/.wrangler/tmp/bundle-tMvm1r/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/opt/homebrew/Cellar/cloudflare-wrangler/4.60.0/libexec/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/iDrDex/.canonic/design/TALK/.wrangler/tmp/bundle-tMvm1r/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/iDrDex/.canonic/design/TALK/.wrangler/tmp/bundle-tMvm1r/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["surfaces", "cached", "text", "res", "h", "payload", "headers", "timeout_ms", "chat"]
}
