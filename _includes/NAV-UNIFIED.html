<!-- NAV | ONE PRIMITIVE | DESIGN.md 255 Map -->
<!-- Double-fleet tabs (primary) + breadcrumbs + scope links (secondary) + TALK + theme -->
<!-- Modes: default (fleet-tabs+breadcrumbs), post (back+badge), deck (title+counter+timer) -->
{% assign fleet = site.data.fleet %}
{% assign scope_key = page.scope | default: site.scope | downcase %}
{% assign scope_up = page.scope | default: site.scope | upcase %}
{% assign sd = site.data[scope_key] %}
{% assign nav_items = include.nav | default: page.nav | default: sd.nav %}
{% assign mode = include.mode | default: "default" %}

<header class="nav{% if mode == 'deck' %} nav--deck{% endif %}" id="nav" role="navigation">

  <!-- LEFT: Fleet identity (home link) -->
  <div class="nav-left">
    <a class="nav-brand" href="{{ fleet.brand.url | default: '/' | relative_url }}" aria-label="Home">
      <span class="nav-mark">{{ fleet.brand.mark | default: "âˆ©" }}</span>
      <span class="nav-fleet">{{ fleet.brand.label | default: "CANONIC" }}</span>
    </a>
  </div>

  <!-- CENTER: Double-fleet scope tabs (primary) / post-back / deck controls -->
  <div class="nav-center">
    {% if mode == "post" %}
      {% if include.back_href %}<a href="{{ include.back_href | relative_url }}" class="nav-back">&larr; {{ include.back_label | default: "Back" }}</a>{% endif %}
      {% if include.scope_label %}<span class="nav-scope">{{ include.scope_label }}</span>{% endif %}
    {% elsif mode == "deck" %}
      <span class="nav-deck-title">{{ page.brand | default: page.title | default: site.title }}</span>
      <span class="nav-deck-counter"><span id="deckCurr">1</span> / {{ include.slide_count | default: "?" }}</span>
      <span class="nav-deck-timer" id="deckTimer">0:00</span>
    {% else %}
      {% if fleet.sites %}
      <ul class="nav-fleet-tabs">
        {% assign prev_fleet = "" %}
        {% for s in fleet.sites %}
        {% if s.fleet != prev_fleet and prev_fleet != "" %}
        <li class="nav-fleet-sep" aria-hidden="true"></li>
        {% endif %}
        <li><a href="{{ s.url }}"{% if s.scope == scope_up %} class="active"{% endif %}{% if s.accent %} style="--tab-accent: {{ s.accent }}"{% endif %}{% if s.tagline %} title="{{ s.tagline }}"{% endif %}>{{ s.label | default: s.scope }}</a></li>
        {% assign prev_fleet = s.fleet %}
        {% endfor %}
      </ul>
      {% else %}
      <span class="nav-scope">{{ scope_up }}</span>
      {% endif %}
    {% endif %}
  </div>

  <!-- RIGHT: TALK + Theme -->
  <div class="nav-right">
    {% unless page.layout == "custom" %}
    <button class="nav-talk" type="button" onclick="TALK.open()" aria-label="Open TALK">
      <span class="nav-dot"></span>
      <span class="nav-talk-label">TALK</span>
    </button>
    {% endunless %}
    <button class="nav-theme" type="button" onclick="toggleTheme()" id="theme-btn" title="Toggle light/dark">&#9790;</button>
  </div>

  <!-- SUB-ROW: Breadcrumbs + Scope-local links -->
  {% if mode == "default" %}
  <div class="nav-sub" id="navSub">
    <nav class="nav-breadcrumbs" id="navBreadcrumbs" aria-label="Breadcrumb"></nav>
    {% if nav_items %}
    <ul class="nav-links">
      {% for item in nav_items %}
      <li><a href="{{ item.href }}"{% if item.type == "flagship" %} class="active"{% endif %}>{{ item.label }}</a></li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
  {% endif %}

</header>
