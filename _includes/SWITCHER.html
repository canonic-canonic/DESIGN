<!-- SWITCHER | DESIGN.md 255 Map -->
<!-- Tabbed content switcher with graphic/figure panels -->
<div class="switcher" data-switcher="switcher-{{ include.id | default: 'x' }}"{% if include.switcher.default %} data-default="{{ include.switcher.default }}"{% endif %}>
  {% if include.switcher.kicker %}<div class="switcher-kicker">{{ include.switcher.kicker }}</div>{% endif %}

  <div class="switcher-tabs" role="tablist" aria-label="{{ include.switcher.aria_label | default: 'Explore' }}">
    {% for t in include.switcher.tabs %}
    <button type="button" class="switcher-tab{% if forloop.first %} active{% endif %}" role="tab" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}" data-tab="{{ forloop.index0 }}">{{ t.label | default: "Tab" }}</button>
    {% endfor %}
  </div>

  <div class="switcher-panels">
    {% for t in include.switcher.tabs %}
    <div class="switcher-panel{% unless forloop.first %}" hidden{% endunless %}" role="tabpanel" data-panel="{{ forloop.index0 }}">
      <div class="switcher-copy">
        {% if t.title %}<h3>{{ t.title }}</h3>{% endif %}
        {% if t.text %}<p>{{ t.text }}</p>{% endif %}
        {% if t.bullets %}
        <ul class="switcher-bullets">
          {% for b in t.bullets %}<li>{{ b }}</li>{% endfor %}
        </ul>
        {% endif %}
        {% if t.cta %}<div class="switcher-cta"><a href="{{ t.cta.href }}" class="btn btn-secondary">{{ t.cta.label }}</a></div>{% endif %}
        {% if t.footnote %}<div class="switcher-footnote">{{ t.footnote }}</div>{% endif %}
      </div>
      {% if t.figure %}
      <div class="switcher-graphic">
        {% assign fig = t.figure %}
        {% if fig.type == "score-meter" %}{% include figures/SCORE.html score=fig.score label=fig.label %}
        {% elsif fig.type == "pipeline" %}{% include figures/PIPELINE.html steps=fig.steps %}
        {% elsif fig.type == "audit-trail" %}{% include figures/AUDIT.html items=fig.items %}
        {% elsif fig.type == "flow-chain" %}{% include figures/FLOW.html nodes=fig.nodes %}
        {% elsif fig.type == "balance" %}{% include figures/BALANCE.html left=fig.left right=fig.right tilt=fig.tilt %}
        {% elsif fig.type == "gauge" %}{% include figures/GAUGE.html value=fig.value max=fig.max label=fig.label unit=fig.unit %}
        {% elsif fig.type == "donut" %}{% include figures/DONUT.html segments=fig.segments total=fig.total label=fig.label %}
        {% elsif fig.type == "area-chart" %}{% include figures/AREA.html points=fig.points label=fig.label %}
        {% elsif fig.type == "bar-chart" %}{% include figures/BARS.html bars=fig.bars %}
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>

<script>
(function(){
  document.querySelectorAll('[data-switcher]').forEach(function(sw) {
    var tabs = sw.querySelectorAll('.switcher-tab');
    var panels = sw.querySelectorAll('.switcher-panel');
    tabs.forEach(function(tab) {
      tab.addEventListener('click', function() {
        var idx = tab.getAttribute('data-tab');
        tabs.forEach(function(t) { t.classList.remove('active'); t.setAttribute('aria-selected','false'); });
        panels.forEach(function(p) { p.hidden = true; });
        tab.classList.add('active');
        tab.setAttribute('aria-selected','true');
        panels[idx].hidden = false;
      });
    });
    var def = sw.getAttribute('data-default');
    if (def && tabs[def]) tabs[def].click();
  });
})();
</script>
